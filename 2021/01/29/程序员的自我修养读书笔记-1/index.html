<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.2.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>
<meta name="description" content="温故而知新硬件和操作系统历史计算机硬件历史计算机中最重要的是三个部件：cpu，内存，io控制芯片历史：  早期cpu和内存以及io控制器是链接在一条总线上的 后来cpu频率上升，并且图形芯片与内存和cpu交互变多，设计北桥芯片处理这种高速数据交互；对于低速的io设备，设计南桥来总领慢速io设备与北桥通信 单核cpu频率到瓶颈，转向多核架构；最常见的就是SMP(对称多处理器),多个处理器对等，通过总">
<meta property="og:type" content="article">
<meta property="og:title" content="程序员的自我修养读书笔记-1">
<meta property="og:url" content="http://example.com/2021/01/29/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-1/index.html">
<meta property="og:site_name" content="我住8楼">
<meta property="og:description" content="温故而知新硬件和操作系统历史计算机硬件历史计算机中最重要的是三个部件：cpu，内存，io控制芯片历史：  早期cpu和内存以及io控制器是链接在一条总线上的 后来cpu频率上升，并且图形芯片与内存和cpu交互变多，设计北桥芯片处理这种高速数据交互；对于低速的io设备，设计南桥来总领慢速io设备与北桥通信 单核cpu频率到瓶颈，转向多核架构；最常见的就是SMP(对称多处理器),多个处理器对等，通过总">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-01-29T07:18:28.000Z">
<meta property="article:modified_time" content="2021-01-29T08:26:06.081Z">
<meta property="article:author" content="Jason Chao">
<meta property="article:tag" content="software">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2021/01/29/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-1/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<title>程序员的自我修养读书笔记-1 | 我住8楼</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">我住8楼</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B8%A9%E6%95%85%E8%80%8C%E7%9F%A5%E6%96%B0"><span class="nav-number">1.</span> <span class="nav-text">温故而知新</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A1%AC%E4%BB%B6%E5%92%8C%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8E%86%E5%8F%B2"><span class="nav-number">1.1.</span> <span class="nav-text">硬件和操作系统历史</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6%E5%8E%86%E5%8F%B2"><span class="nav-number">1.1.1.</span> <span class="nav-text">计算机硬件历史</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8E%86%E5%8F%B2"><span class="nav-number">1.1.2.</span> <span class="nav-text">操作系统历史</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%B0%E4%BB%A3%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9FCPU%E6%8A%BD%E8%B1%A1-%E7%BA%BF%E7%A8%8B"><span class="nav-number">1.2.</span> <span class="nav-text">现代操作系统CPU抽象-线程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%92%8C%E9%93%BE%E6%8E%A5"><span class="nav-number">2.</span> <span class="nav-text">编译和链接</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="nav-number">2.1.</span> <span class="nav-text">构建过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B"><span class="nav-number">2.2.</span> <span class="nav-text">编译过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E8%BF%87%E7%A8%8B"><span class="nav-number">2.3.</span> <span class="nav-text">链接过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5"><span class="nav-number">2.3.1.</span> <span class="nav-text">静态链接</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6%E9%87%8C%E6%9C%89%E4%BB%80%E4%B9%88"><span class="nav-number">3.</span> <span class="nav-text">目标文件里有什么</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E7%BB%84%E6%88%90%E6%88%90%E5%88%86"><span class="nav-number">3.1.</span> <span class="nav-text">目标文件中的组成成分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ELF%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E6%8F%8F%E8%BF%B0"><span class="nav-number">3.2.</span> <span class="nav-text">ELF文件结构描述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ELF-Header"><span class="nav-number">3.2.1.</span> <span class="nav-text">ELF Header</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AE%B5%E8%A1%A8"><span class="nav-number">3.2.2.</span> <span class="nav-text">段表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8"><span class="nav-number">3.2.3.</span> <span class="nav-text">重定位表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A1%A8"><span class="nav-number">3.2.4.</span> <span class="nav-text">字符串表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E7%9A%84%E6%8E%A5%E5%8F%A3-%E7%AC%A6%E5%8F%B7"><span class="nav-number">3.3.</span> <span class="nav-text">链接的接口-符号</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#elf%E7%AC%A6%E5%8F%B7%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.1.</span> <span class="nav-text">elf符号表结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7"><span class="nav-number">3.3.2.</span> <span class="nav-text">特殊符号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E4%BF%AE%E9%A5%B0%E4%B8%8E%E5%87%BD%E6%95%B0%E7%AD%BE%E5%90%8D"><span class="nav-number">3.3.3.</span> <span class="nav-text">符号修饰与函数签名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#extern-%E2%80%9CC%E2%80%9D"><span class="nav-number">3.3.4.</span> <span class="nav-text">extern “C”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%B1%E7%AC%A6%E5%8F%B7%E4%B8%8E%E5%BC%BA%E7%AC%A6%E5%8F%B7"><span class="nav-number">3.3.5.</span> <span class="nav-text">弱符号与强符号</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E4%BF%A1%E6%81%AF"><span class="nav-number">3.4.</span> <span class="nav-text">调试信息</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jason Chao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/29/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          程序员的自我修养读书笔记-1
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-01-29 15:18:28 / 修改时间：16:26:06" itemprop="dateCreated datePublished" datetime="2021-01-29T15:18:28+08:00">2021-01-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="温故而知新"><a href="#温故而知新" class="headerlink" title="温故而知新"></a>温故而知新</h1><h2 id="硬件和操作系统历史"><a href="#硬件和操作系统历史" class="headerlink" title="硬件和操作系统历史"></a>硬件和操作系统历史</h2><h3 id="计算机硬件历史"><a href="#计算机硬件历史" class="headerlink" title="计算机硬件历史"></a>计算机硬件历史</h3><p>计算机中最重要的是三个部件：cpu，内存，io控制芯片<br>历史：</p>
<ol>
<li>早期cpu和内存以及io控制器是链接在一条总线上的</li>
<li>后来cpu频率上升，并且图形芯片与内存和cpu交互变多，设计北桥芯片处理这种高速数据交互；对于低速的io设备，设计南桥来总领慢速io设备与北桥通信</li>
<li>单核cpu频率到瓶颈，转向多核架构；最常见的就是SMP(对称多处理器),多个处理器对等，通过总线通信。（多核处理器是SMP的简化版，它将多个核心打包，共享昂贵的缓存组件以单个处理器的方式售卖)</li>
</ol>
<h3 id="操作系统历史"><a href="#操作系统历史" class="headerlink" title="操作系统历史"></a>操作系统历史</h3><p>操作系统两个功能：</p>
<ol>
<li>提供一个抽象的接口</li>
<li>管理硬件资源</li>
</ol>
<p>CPU资源利用历史：</p>
<ol>
<li>多道程序：可以多个程序流水线执行，不用一个程序等待上一个程序完全处理完成（比如程序最后是写磁盘，但是依然不让下一个程序开始用闲下来的CPU资源）</li>
<li>分时系统：每个程序运行一段时间，主动放弃cpu</li>
<li>多任务系统：操作系统接管所有硬件资源，各任务以进程方式运行，cpu轮流调度不同进程；如果cpu会强行打断任务执行，根据优先级将cpu资源分配给别的进程，那么这就是抢占式任务调度方式。</li>
</ol>
<p>设备驱动：</p>
<ol>
<li>面向硬件接口编程</li>
<li>统一抽象，交给硬件驱动程序来处理</li>
</ol>
<p>内存：</p>
<ol>
<li>直接操作硬件RAM<ol>
<li>地址空间不隔离</li>
<li>内存使用率低，整块连续内存不停换入换出</li>
<li>程序运行的地址不确定</li>
</ol>
</li>
<li>分段技术：整段内存空间映射到虚拟地址空间<ol>
<li>解决了第一和第三个问题，但是第二问题还没有解决，映射粒度太大，空间不够时，可能小粒度的空间和等于需要的空间，但是不连续，无法映射</li>
</ol>
</li>
<li>分页技术：将内存按页4K来划分，换入换出以页为单位，粒度小，利用效率高</li>
</ol>
<h2 id="现代操作系统CPU抽象-线程"><a href="#现代操作系统CPU抽象-线程" class="headerlink" title="现代操作系统CPU抽象-线程"></a>现代操作系统CPU抽象-线程</h2><ol>
<li>线程基础<ol>
<li>线程有自己的私有存储空间：局部变量，函数的参数，TLS（线程局部存储）数据</li>
<li>线程共享存储（进程所有）：全局变量，堆上的数据，函数里的静态变量，程序代码，打开的文件</li>
<li>状态：运行、就绪、等待</li>
</ol>
</li>
<li>线程安全<ol>
<li>同步与锁<ol>
<li>二元信号量：任意线程获取和释放</li>
<li>互斥量：哪个线程获取，哪个线程释放</li>
<li>临界区：仅限本进程，信号量和互斥量在任何进程都可见</li>
<li>读写锁：分独占和共享方式获取</li>
<li>条件变量：类似栅栏，等待和唤醒</li>
<li>可重入：并发安全的保障</li>
</ol>
</li>
</ol>
</li>
<li>线程模型<ol>
<li>一对一模型：一个用户线程对应一个内核线程</li>
<li>多对一模型：多个用户线程对应一个内核线程，用不线程切换由用户代码执行，如果一个用户线程阻塞，会阻塞所有其他同核的用户线程</li>
<li>多对多模型：多个用户线程对应多个内核线程，性能提升没有一对一高，资源利用率最高了</li>
</ol>
</li>
</ol>
<h1 id="编译和链接"><a href="#编译和链接" class="headerlink" title="编译和链接"></a>编译和链接</h1><h2 id="构建过程"><a href="#构建过程" class="headerlink" title="构建过程"></a>构建过程</h2><ol>
<li>预编译<ol>
<li>将#define删除，并展开所有宏定义</li>
<li>处理所有条件预编译命令</li>
<li>处理#include预编译命令，将被包含的文件插入到对应位置</li>
<li>删除注释</li>
<li>添加文件行号和文件名标识</li>
<li>保留所有#pragma命令</li>
</ol>
</li>
<li>编译<ol>
<li>词法分析，语法分析，语义分析，生成汇编文件</li>
</ol>
</li>
<li>汇编<ol>
<li>将汇编代码转变为机器可执行指令</li>
</ol>
</li>
<li>链接<ol>
<li>将最终程序所需的所有文件都链接起来</li>
</ol>
</li>
</ol>
<h2 id="编译过程"><a href="#编译过程" class="headerlink" title="编译过程"></a>编译过程</h2><ol>
<li>词法分析<ol>
<li>执行类似有限状态机的算法来将字符序列分割成一系列的记号</li>
<li>将记号分类为：关键字，标识符，字面量（包含数字，字符串等），特殊符号（加减号之类的）</li>
</ol>
</li>
<li>语法分析<ol>
<li>采用上下文无关语法来生成语法树，节点是表达式</li>
</ol>
</li>
<li>语义分析<ol>
<li>静态语义分析<ol>
<li>声明与类型的匹配</li>
<li>类型的转换</li>
<li>将语法树的每个节点标识了类型</li>
</ol>
</li>
</ol>
</li>
<li>中间语言生成<ol>
<li>将语法树转换为三地址码（x = y op z）</li>
<li>中间语言将编译器分割成前端和后端，前端将源码翻译成机器无关的中间代码，后端将中间代码转换为机器代码</li>
</ol>
</li>
<li>目标代码生成与优化<ol>
<li>属于编译器后端，包括代码生成器和目标代码优化器</li>
</ol>
</li>
</ol>
<h2 id="链接过程"><a href="#链接过程" class="headerlink" title="链接过程"></a>链接过程</h2><p>就是各个目标文件链接起来拼成最终目标文件。</p>
<h3 id="静态链接"><a href="#静态链接" class="headerlink" title="静态链接"></a>静态链接</h3><ol>
<li>地址和空间分配</li>
<li>符号决议（符号绑定）<ol>
<li>当编译器遇到一个不是本模块定义的符号时，会假设该函数由其它模块定义，并生成一个链接器符号表条目，交由链接器处理。如果链接器在它的任何输入模块都没有找到该符号，会给出一个类似undefined reference to ‘xxx’的链接错误。而如果链接器在输入模块中找到了一个以上的外部符号定义，这个时候就需要链接器进行符号决议，链接器对多个外部符号定义可能并不报错甚至警告，而是按照它的规则去选择其中一个符号定义。</li>
</ol>
</li>
<li>重定位<ol>
<li>计算各个目标地址的过程叫重定位</li>
</ol>
</li>
</ol>
<h1 id="目标文件里有什么"><a href="#目标文件里有什么" class="headerlink" title="目标文件里有什么"></a>目标文件里有什么</h1><h2 id="目标文件中的组成成分"><a href="#目标文件中的组成成分" class="headerlink" title="目标文件中的组成成分"></a>目标文件中的组成成分</h2><ol>
<li>代码段.text</li>
<li>数据段.data</li>
<li>未初始化数据段.bss: 只是为未初始化的全局变量和局部静态变量预留位置而已</li>
<li>只读数据段.rodata</li>
<li>调试信息段.debug</li>
<li>编译器版本信息段.comment</li>
<li>动态链接信息段.dynamic</li>
<li>字符串表.strtab, 存放各种字符串</li>
<li>符号表.symtab</li>
<li>段名表.shstrtab</li>
<li>初始化和终结代码段.init/.fini</li>
<li>动态链接的跳转表和全局入口表.plt/.got</li>
</ol>
<h2 id="ELF文件结构描述"><a href="#ELF文件结构描述" class="headerlink" title="ELF文件结构描述"></a>ELF文件结构描述</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|    ELF Header      |</span><br><span class="line">|     .text          |</span><br><span class="line">|     .data          |</span><br><span class="line">|     .bss           |</span><br><span class="line">|  other sections    |</span><br><span class="line">|section header table|</span><br><span class="line">|  string tables     |</span><br><span class="line">|  symbol tables     |</span><br><span class="line">|      ...           |</span><br></pre></td></tr></table></figure>
<h3 id="ELF-Header"><a href="#ELF-Header" class="headerlink" title="ELF Header"></a>ELF Header</h3><p>包含ELF魔数、文件机器字节长度、数据存储个方式、版本、运行平台、ABI 版本、ELF重定位类型、硬件平台、硬件平台版本、入口地址、程序头入口和长度、段表的位置和长度、段的数量。其结构及相关常数被定义在/usr/include/elf.h里。</p>
<p>其中elf魔数的前16个字节被ELF标准规定用来标识ELF文件的平台属性，比如字长、字节序、elf文件版本信息等</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; simplesection.c </span><br><span class="line"></span><br><span class="line">int printf(const char* format, ...);</span><br><span class="line">int global_init_var &#x3D; 84;</span><br><span class="line">int global_uninit_var;</span><br><span class="line"></span><br><span class="line">void func1(int i) &#123;</span><br><span class="line">    printf(&quot;%d\n&quot;, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void) &#123;</span><br><span class="line">    static int static_var &#x3D; 85;</span><br><span class="line">    static int static_var2;</span><br><span class="line"></span><br><span class="line">    int a &#x3D; 1;</span><br><span class="line">    int b;</span><br><span class="line"></span><br><span class="line">    func1(static_var + static_var2 + a + b);</span><br><span class="line"></span><br><span class="line">    return a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; $ readelf -h simplesection.o</span><br><span class="line"></span><br><span class="line">ELF Header:</span><br><span class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00</span><br><span class="line">  Class:                             ELF64</span><br><span class="line">  Data:                              2&#39;s complement, little endian</span><br><span class="line">  Version:                           1 (current)</span><br><span class="line">  OS&#x2F;ABI:                            UNIX - System V</span><br><span class="line">  ABI Version:                       0</span><br><span class="line">  Type:                              REL (Relocatable file)</span><br><span class="line">  Machine:                           Advanced Micro Devices X86-64</span><br><span class="line">  Version:                           0x1</span><br><span class="line">  Entry point address:               0x0</span><br><span class="line">  Start of program headers:          0 (bytes into file)</span><br><span class="line">  Start of section headers:          376 (bytes into file)</span><br><span class="line">  Flags:                             0x0</span><br><span class="line">  Size of this header:               64 (bytes)</span><br><span class="line">  Size of program headers:           0 (bytes)</span><br><span class="line">  Number of program headers:         0</span><br><span class="line">  Size of section headers:           64 (bytes)</span><br><span class="line">  Number of section headers:         13</span><br><span class="line">  Section header string table index: 10</span><br></pre></td></tr></table></figure>


<h3 id="段表"><a href="#段表" class="headerlink" title="段表"></a>段表</h3><p>段表是保存elf文件中各种各样的段基本属性的结构。描述了elf的各个段的信息，比如每个段的段名、段的长度、在文件中的偏移、读写权限及段的其他属性。编译器、链接器、装载器都是依靠段表来定位和访问各个段的属性的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; $ readelf -S a.o</span><br><span class="line"></span><br><span class="line">There are 13 section headers, starting at offset 0x178:</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type             Address           Offset</span><br><span class="line">       Size              EntSize          Flags  Link  Info  Align</span><br><span class="line">  [ 0]                   NULL             0000000000000000  00000000</span><br><span class="line">       0000000000000000  0000000000000000           0     0     0</span><br><span class="line">  [ 1] .text             PROGBITS         0000000000000000  00000040</span><br><span class="line">       0000000000000054  0000000000000000  AX       0     0     4</span><br><span class="line">  [ 2] .rela.text        RELA             0000000000000000  000006a0</span><br><span class="line">       0000000000000078  0000000000000018          11     1     8</span><br><span class="line">  [ 3] .data             PROGBITS         0000000000000000  00000094</span><br><span class="line">       0000000000000008  0000000000000000  WA       0     0     4</span><br><span class="line">  [ 4] .bss              NOBITS           0000000000000000  0000009c</span><br><span class="line">       0000000000000004  0000000000000000  WA       0     0     4</span><br><span class="line">  [ 5] .rodata           PROGBITS         0000000000000000  0000009c</span><br><span class="line">       0000000000000004  0000000000000000   A       0     0     1</span><br><span class="line">  [ 6] .comment          PROGBITS         0000000000000000  000000a0</span><br><span class="line">       0000000000000012  0000000000000001  MS       0     0     1</span><br><span class="line">  [ 7] .note.GNU-stack   PROGBITS         0000000000000000  000000b2</span><br><span class="line">       0000000000000000  0000000000000000           0     0     1</span><br><span class="line">  [ 8] .eh_frame         PROGBITS         0000000000000000  000000b8</span><br><span class="line">       0000000000000058  0000000000000000   A       0     0     8</span><br><span class="line">  [ 9] .rela.eh_frame    RELA             0000000000000000  00000718</span><br><span class="line">       0000000000000030  0000000000000018          11     8     8</span><br><span class="line">  [10] .shstrtab         STRTAB           0000000000000000  00000110</span><br><span class="line">       0000000000000061  0000000000000000           0     0     1</span><br><span class="line">  [11] .symtab           SYMTAB           0000000000000000  000004b8</span><br><span class="line">       0000000000000180  0000000000000018          12    11     8</span><br><span class="line">  [12] .strtab           STRTAB           0000000000000000  00000638</span><br><span class="line">       0000000000000066  0000000000000000           0     0     1</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), l (large)</span><br><span class="line">  I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown)</span><br><span class="line">  O (extra OS processing required) o (OS specific), p (processor specific)</span><br></pre></td></tr></table></figure>


<h3 id="重定位表"><a href="#重定位表" class="headerlink" title="重定位表"></a>重定位表</h3><p>.rela.text段，重定位表，记录代码段和数据段对绝对地址的引用的位置。</p>
<h3 id="字符串表"><a href="#字符串表" class="headerlink" title="字符串表"></a>字符串表</h3><p>因为elf文件中用到了很多字符串，比如段名、变量名等，因为字符串的长度往往是不确定的，所以用固定的结构来表示它比较困难。一种很常见的做法是把字符串集中起来存放到一个表，然后使用字符串在表中的偏移来引用字符串。</p>
<p>字符串表.strtab,用来存放普通的字符串，比如符号名字； 段表字符串表.shstrtab用来保持段表中用到的字符串，最常见的就是段名。</p>
<h2 id="链接的接口-符号"><a href="#链接的接口-符号" class="headerlink" title="链接的接口-符号"></a>链接的接口-符号</h2><p>最值得关注的是全局符号，因为链接过程只关心全局符号的相互“粘合”，局部符号、段名、行号等都是次要的，它们对于其他的目标文件来说是不可见的，在链接过程中无关紧要。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; $ nm simplesection.o</span><br><span class="line"></span><br><span class="line">0000000000000000 T func1</span><br><span class="line">0000000000000000 D global_init_var</span><br><span class="line">0000000000000004 C global_uninit_var</span><br><span class="line">0000000000000021 T main</span><br><span class="line">                 U printf</span><br><span class="line">0000000000000004 d static_var.1731</span><br><span class="line">0000000000000000 b static_var2.1732</span><br></pre></td></tr></table></figure>


<h3 id="elf符号表结构"><a href="#elf符号表结构" class="headerlink" title="elf符号表结构"></a>elf符号表结构</h3><p>elf文件中的一个段，段名叫.symtab。包含符号的信息：符号名、符号值（地址或绝对值）、符号大小、符号类型（数据对象、函数、段等）和绑定信息（局部，全局，弱引用）、符号所在的段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; $ readelf -s simplesection.o</span><br><span class="line"></span><br><span class="line">Symbol table &#39;.symtab&#39; contains 16 entries:</span><br><span class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND</span><br><span class="line">     1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS simplesection.c</span><br><span class="line">     2: 0000000000000000     0 SECTION LOCAL  DEFAULT    1</span><br><span class="line">     3: 0000000000000000     0 SECTION LOCAL  DEFAULT    3</span><br><span class="line">     4: 0000000000000000     0 SECTION LOCAL  DEFAULT    4</span><br><span class="line">     5: 0000000000000000     0 SECTION LOCAL  DEFAULT    5</span><br><span class="line">     6: 0000000000000004     4 OBJECT  LOCAL  DEFAULT    3 static_var.1731</span><br><span class="line">     7: 0000000000000000     4 OBJECT  LOCAL  DEFAULT    4 static_var2.1732</span><br><span class="line">     8: 0000000000000000     0 SECTION LOCAL  DEFAULT    7</span><br><span class="line">     9: 0000000000000000     0 SECTION LOCAL  DEFAULT    8</span><br><span class="line">    10: 0000000000000000     0 SECTION LOCAL  DEFAULT    6</span><br><span class="line">    11: 0000000000000000     4 OBJECT  GLOBAL DEFAULT    3 global_init_var</span><br><span class="line">    12: 0000000000000004     4 OBJECT  GLOBAL DEFAULT  COM global_uninit_var</span><br><span class="line">    13: 0000000000000000    33 FUNC    GLOBAL DEFAULT    1 func1</span><br><span class="line">    14: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND printf</span><br><span class="line">    15: 0000000000000021    51 FUNC    GLOBAL DEFAULT    1 main</span><br></pre></td></tr></table></figure>


<h3 id="特殊符号"><a href="#特殊符号" class="headerlink" title="特殊符号"></a>特殊符号</h3><p>链接器会定义很多特殊的符号，比如程序起始地址、结束地址等，可以在程序中使用它们。</p>
<h3 id="符号修饰与函数签名"><a href="#符号修饰与函数签名" class="headerlink" title="符号修饰与函数签名"></a>符号修饰与函数签名</h3><p>符号修饰是为了统一符号名，以免冲突。</p>
<p>C++符号修饰</p>
<ol>
<li>函数签名，包含了一个函数的信息，包括函数名、它的参数类型、它所在的类和名称空间及其他信息。用于识别不同的函数（比如重载的函数）。通常是用名称修饰的方式来做签名。</li>
<li>符号修饰也可以用来防止静态变量的名字冲突。</li>
</ol>
<h3 id="extern-“C”"><a href="#extern-“C”" class="headerlink" title="extern “C”"></a>extern “C”</h3><p>避免c++符号修饰导致不识别c函数</p>
<h3 id="弱符号与强符号"><a href="#弱符号与强符号" class="headerlink" title="弱符号与强符号"></a>弱符号与强符号</h3><p>强符号是函数和初始化了的全局变量；弱符号是未初始化的全局变量。<br>链接器处理强符号、弱符号的规则</p>
<ol>
<li>不允许强符号被多次定义</li>
<li>如果有一个强符号，多个弱符号，选择强符号</li>
<li>如果都是弱符号，选择占用空间最大的一个</li>
</ol>
<p>强引用和弱引用<br>对外部目标文件定义的符号在目标文件最终被链接时，如果找不到该符号的定义，报未定义错误，这种被称为强引用。如果有定义，则引用该定义，如果没有，也不报错，就是弱引用。</p>
<h2 id="调试信息"><a href="#调试信息" class="headerlink" title="调试信息"></a>调试信息</h2><p>elf采用一种称为DWARF（Debug with arbitrary record format）格式的调试信息格式。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/software/" rel="tag"># software</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/01/29/stl%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-%E5%BA%8F%E5%88%97%E5%BC%8F%E5%AE%B9%E5%99%A8/" rel="prev" title="stl源码剖析-序列式容器">
                  <i class="fa fa-chevron-left"></i> stl源码剖析-序列式容器
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/01/29/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-2/" rel="next" title="程序员的自我修养读书笔记-2">
                  程序员的自我修养读书笔记-2 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason Chao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
