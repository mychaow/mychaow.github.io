<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.2.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>
<meta property="og:type" content="website">
<meta property="og:title" content="我住8楼">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="我住8楼">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Jason Chao">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>
<title>我住8楼</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">我住8楼</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jason Chao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/20/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/20/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/" class="post-title-link" itemprop="url">数据库学习计划</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-03-20 15:51:58" itemprop="dateCreated datePublished" datetime="2022-03-20T15:51:58+08:00">2022-03-20</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/19/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9004/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/19/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9004/" class="post-title-link" itemprop="url">h2源码分析04</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-03-19 22:40:29 / 修改时间：22:40:51" itemprop="dateCreated datePublished" datetime="2022-03-19T22:40:29+08:00">2022-03-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="语法树"><a href="#语法树" class="headerlink" title="语法树"></a>语法树</h1>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/16/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9003/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/16/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9003/" class="post-title-link" itemprop="url">h2源码分析03</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-03-16 22:33:02" itemprop="dateCreated datePublished" datetime="2022-03-16T22:33:02+08:00">2022-03-16</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-19 22:39:51" itemprop="dateModified" datetime="2022-03-19T22:39:51+08:00">2022-03-19</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="解析器"><a href="#解析器" class="headerlink" title="解析器"></a>解析器</h1><h2 id="词法解析器"><a href="#词法解析器" class="headerlink" title="词法解析器"></a>词法解析器</h2><p>字符流中每个字符被分为以下几类：</p>
<ol>
<li>CHAR_END<ol>
<li>字符流结束</li>
</ol>
</li>
<li>CHAR_VALUE<ol>
<li>标识符，数字</li>
</ol>
</li>
<li>CHAR_QUOTED<ol>
<li>双引号，一般用来把别名包起来</li>
</ol>
</li>
<li>CHAR_NAME<ol>
<li>标识符，字母</li>
</ol>
</li>
<li>CHAR_SPECIAL_1<ol>
<li>只是一个符号组成一个运算符，例如&lt;</li>
</ol>
</li>
<li>CHAR_SPECIAL_2<ol>
<li>两个符号组成一个运算符，例如||，&amp;&amp;</li>
</ol>
</li>
<li>CHAR_STRING<ol>
<li>单引号括起来的字符串    </li>
</ol>
</li>
<li>CHAR_DOT<ol>
<li>点符号</li>
</ol>
</li>
<li>CHAR_DOLLAR_QUOTED_STRING<ol>
<li>两个$$符号包起来的字符串</li>
</ol>
</li>
</ol>
<p>词法解析器比较简单，将token流按需要支持的token类型进行分类，分成上述的9大类。</p>
<p>对整个sql字符串进行一个字符一个字符的拆解，然后按类型进行标识。</p>
<p>然后对每个token进行拆分，拆分成124个关键字中的一个，包括符号和关键字。</p>
<p>分两步：</p>
<ol>
<li>先扫描所有的字符流，将字符划分为上述9类</li>
<li>然后开始扫描字符流，按定义的124个关键字来开始解析语句<ol>
<li>解析方式是按支持的语法来一条一条的match，看起来非常繁琐，跟antlr4之类的比起来差远了</li>
</ol>
</li>
</ol>
<h2 id="语法解析器"><a href="#语法解析器" class="headerlink" title="语法解析器"></a>语法解析器</h2><p>语法解析器主要是按H2需要支持的语法，对token流进行解析。</p>
<p>大概思路是：</p>
<p>读取第一个token，找到其所属的表达式类型，然后再按该表达式类型进行后续的token解析，如果解析不通就直接报错</p>
<h2 id="SQL计划"><a href="#SQL计划" class="headerlink" title="SQL计划"></a>SQL计划</h2><p>几个主要类：</p>
<ol>
<li>CommandInterface，接口类，所有plan的父类，有101种plan（主要还是create、drop、alter以及其他运维plan），还是不算select的变化，提供执行接口</li>
<li>CommandRemote，继承CommandInterface，客户端的plan，也就是其实可以在客户端直接解析成plan，然后丢给server直接运行？看起来只是把参数传递给远端，跟PreparedStatement类似，直接在远端生成计划，然后client传递一些参数过去，就把这次参数填充给计划，省得又解析一次。但是客户端确实可以解析一次。这里会给server传一个id，这个id是prepareStatement时创建的，用来记录编译好的command。</li>
<li>Command，继承CommandInterface，服务端的plan</li>
<li>CommandContainer，继承Command，封装的是一个Prepared Statement，比Prepared多提供重新编译（实际上就是重新解析）和清理临时表资源的接口</li>
<li>Prepared，抽象类，即H2的PreparedStatement表示</li>
<li>CommandList类，里面装了一堆command，一般是jdbc发过来多条sql，解析后放到这里</li>
</ol>
<img src="/2022/03/16/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9003/Command.png" class="" title="Command">



<h2 id="Parser"><a href="#Parser" class="headerlink" title="Parser"></a>Parser</h2><p>执行上面的语法解析操作，主要两个方法：</p>
<ul>
<li>prepare，用来预编译PrepareStatement</li>
<li>prepareCommand，正常的用来编译计划的，并且会申请资源</li>
</ul>
<img src="/2022/03/16/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9003/Parser.png" class="" title="Parser">



<h3 id="PreparedStatement"><a href="#PreparedStatement" class="headerlink" title="PreparedStatement"></a>PreparedStatement</h3><p>优点：</p>
<ul>
<li>简化Statement中的操作</li>
<li>提高执行语句的性能</li>
<li>可读性和可维护性更好</li>
<li>安全性更好。 使用PreparedStatement能够预防SQL注入攻击，所谓SQL注入，指的是通过把SQL命令插入到Web表单提交或者输入域名或者页面请求的查询字符串，最终达到欺骗服务器，达到执行恶意SQL命令的目的。注入只对SQL语句的编译过程有破坏作用，而执行阶段只是把输入串作为数据处理，不再需要对SQL语句进行解析，因此也就避免了类似select * from user where name=’aa’ and password=’bb’ or 1=1的sql注入问题的发生。</li>
</ul>
<p>原理：</p>
<ul>
<li>PreparedStatement的预编译是数据库进行的，编译后的函数key是缓存在PreparedStatement中的，编译后的函数是缓存在数据库服务器中的。预编译前有检查sql语句语法是否正确的操作。只有数据库服务器支持预编译功能时，JDBC驱动才能够使用数据库的预编译功能，否则会报错。预编译在比较新的JDBC驱动版本中默认是关闭的，需要配置连接参数才能够打开。在已经配置好了数据库连接参数的情况下，Statement对于MySQL数据库是不会对编译后的函数进行缓存的，数据库不会缓存函数，Statement也不会缓存函数的key，所以多次执行相同的一条sql语句的时候，还是会先检查sql语句语法是否正确，然后编译sql语句成函数，最后执行函数。</li>
<li>对于PreparedStatement在设置参数的时候会对参数进行转义处理。</li>
<li>因为PreparedStatement已经对sql模板进行了编译，并且存储了函数，所以PreparedStatement做的就是把参数进行转义后直接传入参数到数据库，然后让函数执行。这就是为什么PreparedStatement能够防止sql注入攻击的原因了。</li>
<li>PreparedStatement的预编译还有注意的问题，在数据库端存储的函数和在PreparedStatement中存储的key值，都是建立在数据库连接的基础上的，如果当前数据库连接断开了，数据库端的函数会清空，建立在连接上的PreparedStatement里面的函数key也会被清空，各个连接之间的预编译都是互相独立的。</li>
<li>开启PrepareStatement预编译，如果不重用preparestatement，最好是开启preparecache，不然每次新建一个同样prepareStatement都会重新预编译一次。</li>
</ul>
<h1 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h1><h2 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h2><p>有以下对象：</p>
<ul>
<li>schema</li>
<li>table</li>
<li>view</li>
<li>index</li>
<li>trigger</li>
<li>role</li>
<li>user</li>
<li>sequence，递增值</li>
<li>domain，用户可以自定义的值域，例如创建自定义的值域后，可以对某个列加限制取值只能是该值域内的</li>
<li>constant</li>
<li>alias</li>
<li>aggregation</li>
</ul>
<h2 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h2><ul>
<li>select</li>
<li>create</li>
<li>update</li>
<li>delete</li>
<li>backup</li>
<li>explain</li>
<li>merge using/to</li>
<li>runscript，运行sql脚本</li>
</ul>
<h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><ul>
<li>checkpoint</li>
<li>commit</li>
<li>rollback</li>
<li>savepoint</li>
<li>grant</li>
<li>revoke</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Marvel__Dead/article/details/69486947">JDBC：深入理解PreparedStatement和Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://www.iteye.com/blog/cs-css-1847772">探究mysql预编译</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ggh19/article/details/22712065?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_ecpm_v1~rank_v31_ecpm-4-22712065.pc_agg_new_rank&utm_term=sql+domain&spm=1000.2123.3001.4430">SQL–域</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/CathyLou/article/details/78626618">sequence的作用和用法</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/16/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9002/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/16/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9002/" class="post-title-link" itemprop="url">h2源码分析02</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-03-16 08:45:41 / 修改时间：22:41:20" itemprop="dateCreated datePublished" datetime="2022-03-16T08:45:41+08:00">2022-03-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="TRACE机制"><a href="#TRACE机制" class="headerlink" title="TRACE机制"></a>TRACE机制</h1><p>五个类：</p>
<ul>
<li>TraceWriter：接口类，提供持久化日志的接口<ul>
<li>TraceWriteAdapter: 继承TraceWriter，实际上是包装的log4j接口，可以将trace信息输出到日志文件中</li>
<li>TraceSystem：继承TraceWriter，提供往console和file输出跟踪日志的接口（名字起的很不好）<ul>
<li>这里会判断日志级别，如果屏蔽了，就不会写入</li>
</ul>
</li>
</ul>
</li>
<li>TraceObject： 被跟踪的对象父类，在debug模式下，提供该对象的一些调用信息</li>
<li>Trace：trace对象，一般是每个模块一个该对象，该对象提供最终的打印跟踪日志接口</li>
</ul>
<img src="/2022/03/16/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9002/Trace.png" class="" title="Trace">



<h1 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h1><p>一个类DBException，提供将其他的异常转换为SQLException和DBException两种，避免给用户抛出其他类型的异常？</p>
<p>还有过滤一些信息里的敏感信息，例如密码啥的。</p>
<h1 id="java的异常机制"><a href="#java的异常机制" class="headerlink" title="java的异常机制"></a>java的异常机制</h1><img src="/2022/03/16/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9002/1491092-20190911155557851-1114659938.png" class="" title="img">

<p><strong><em>\</em>Error（错误）:*</strong>是程序无法处理的错误，表示运行应用程序中较严重问题。大多数错误与代码编写者执行的操作无关，而表示代码运行时 JVM（Java 虚拟机）出现的问题。</p>
<p> **Exception（异常）:**是程序本身可以处理的异常，也有两类：</p>
<ul>
<li><strong>运行时异常</strong>：都是RuntimeException类及其子类异常，如NullPointerException(空指针异常)、IndexOutOfBoundsException(下标越界异常)等，这些异常是不检查异常，程序中可以选择捕获处理，也可以不处理。这些异常一般是由程序逻辑错误引起的，程序应该从逻辑角度尽可能避免这类异常的发生。</li>
<li><strong>非运行时异常</strong> （编译异常）：是RuntimeException以外的异常，类型上都属于Exception类及其子类。从程序语法角度讲是必须进行处理的异常，如果不处理，程序就不能编译通过。如IOException、SQLException等以及用户自定义的Exception异常，一般情况下不自定义检查异常。</li>
</ul>
<p>java的异常（包括error和exception）分为两类：</p>
<ul>
<li><strong>可查的异常（checked exceptions）</strong><ul>
<li>其他的Exception类及其子类都属于可查异常， 这种异常的特点是Java编译器会检查它，也就是说，当程序中可能出现这类异常，要么用try-catch语句捕获它，要么用throws子句声明抛出它，否则编译不会通过。</li>
</ul>
</li>
<li><strong>不可查的异常（unchecked exceptions）</strong><ul>
<li>运行时异常（RuntimeException与其子类）和错误（Error）。</li>
</ul>
</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/duanxz/p/3511695.html">java类中serialversionuid 作用 是什么?举个例子说明</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/116970u/p/11506791.html">运行时异常与受检异常有何异同、error和exception有什么区别</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/" class="post-title-link" itemprop="url">postgresql查询优化探索</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-03-03 22:58:46" itemprop="dateCreated datePublished" datetime="2022-03-03T22:58:46+08:00">2022-03-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-20 20:33:44" itemprop="dateModified" datetime="2022-03-20T20:33:44+08:00">2022-03-20</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>《PostgreSQL技术内幕：查询优化深度探索》 – 张树杰</p>
</blockquote>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="查询优化简介"><a href="#查询优化简介" class="headerlink" title="查询优化简介"></a>查询优化简介</h2><p>查询优化器在系统中的位置。</p>
<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_1646319696307.png" class="" title="img">

<p>查询优化器的好处：</p>
<ul>
<li>比人更了解数据库里数据的信息</li>
<li>比人更了解数据库当前的负载信息</li>
<li>计算能力比人类强，可以快速筛选多种信息</li>
</ul>
<h2 id="逻辑优化"><a href="#逻辑优化" class="headerlink" title="逻辑优化"></a>逻辑优化</h2><p>基于关系代数。</p>
<h3 id="关系模型"><a href="#关系模型" class="headerlink" title="关系模型"></a>关系模型</h3><p>两种形式化语言：</p>
<ul>
<li>关系代数<ul>
<li>从逻辑角度定义了数据操作的方式，是一门过程语言</li>
<li>接近实际运行中的各种算子操作</li>
</ul>
</li>
<li>关系演算<ul>
<li>描述性的，刻画需要的获得的结果而不关心获得结果的过程，是一门描述性语言</li>
<li>接近sql语句</li>
</ul>
</li>
</ul>
<p> <strong>关系代数</strong></p>
<p>五种基本操作：</p>
<ul>
<li>选择，根据某些条件对关系做水平分割，即选择符合条件的元组<ul>
<li>数学描述：<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/405_f67_f95.gif" class="" title="\sigma_{con}(R) &#x3D; \{t\ |\ t \in R \wedge con(t) &#x3D;\ true \}"><ul>
<li>设<img src="postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/406_30b_24c.gif" alt="R(A_{1},A_{2},...,A_{n})">，t是R的元组，t的分量记做<img src="postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/407_548_df4.gif" alt="t[A_{i}]">，或简写为<img src="postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/600_275_5fd.gif" alt="A_{i}"></li>
<li>条件con由逻辑运算符连接比较表达式组成</li>
<li>逻辑运算符：<img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/408_8f2_c44.gif" alt="\wedge">，<img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/409_73c_d7c.gif" alt="\vee">，<img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/410_005_e63.gif" alt="\lnot">或谢伟and，or，not</li>
<li>比较表达式：<img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/411_aa5_208.gif" alt="X \theta Y">，其中X，Y是t的分量、常量或简单函数，<img src="https://ewr1.vultrobjects.com/imgur2/000/005/605/864_81c_f01.gif" alt="\theta">是比较运算符，<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/412_b6b_06e-16477795772332.gif" class="" title="\theta \in \{ &gt;, \ge,&lt;,\le,&#x3D;,\ne\}"></li>
</ul>
</li>
</ul>
</li>
<li>投影，对关系进行垂直分割，消去某些列，并重新安排列的顺序，再删去重复元组<ul>
<li>数学描述：<img src="postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/415_8e9_bd8.gif" alt="\Pi_{A_{i1},A_{i2},...,A_{ik}}(R)=\{&lt;t[A_{i1}],t[A_{i2}],...,t[A_{ik}]&gt;| \ t \in R\}"><ul>
<li>设<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/406_30b_24c-16477796207703.gif" class="" title="R(A_{1},A_{2},...,A_{n})"></li>
<li><img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/416_b71_2bf.gif" class="" title="\{{A_{i1},A_{i2},...,A_{ik} \} \subseteq \{{A_{1},A_{2},...,A_{n} \}"></li>
<li><img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/417_d94_d6e.gif" alt="t[A_{i1}]">表示元组t中相应于属性<img src="https://ewr1.vultrobjects.com/imgur2/000/008/002/600_275_5fd.gif" alt="A_{i}">的分量</li>
<li>投影运算可以对原关系的列在投影后重新排列</li>
</ul>
</li>
</ul>
</li>
<li>笛卡尔积，设关系R和关系S的元数分别为r和s。定义R和S的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF&spm=1001.2101.3001.7020">笛卡尔积</a>是一个(r+s)元的元组集合，每个元组的前r个分量来自R的一个元组，后s个分量来自S的一个元组<ul>
<li>数学描述：<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/399_d3d_dfd.gif" class="" title="R \times S &#x3D; \{&lt;a_{1}, a_{2},...,a_{n},b_{1}, b_{2},...,b_{m}&gt; |\\ &lt;a_{1}, a_{2},...,a_{n}&gt; \ \in R \ \wedge &lt;b_{1}, b_{2},...,b_{m}&gt; \ \in S\}"></li>
<li><img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/400_77e_85a.gif" class="" title="R \times S &#x3D; S \times R">（行位置无关性和列位置无关性）</li>
<li>R是n度关系，S是m度关系，<img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/398_32e_62d.gif" alt="R \times S">是<img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/401_666_624.gif" alt="n+m">度关系</li>
<li>R基数是x，S基数是y，<img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/398_32e_62d.gif" alt="R \times S">基数是<img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/402_91b_762.gif" alt="x \times y"></li>
</ul>
</li>
<li>并集，设关系R和关系S具有相同的元数n，且相应的属性取自同一个域，则关系R和关系S的并由属于R或属于S的元组组成，其结果仍为n元的关系<ul>
<li>数学表述：<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/391_4b0_635.gif" class="" title="R \cup S &#x3D; \{t | t \in R \vee t \in S \}">，其中t是元组</li>
<li>并运算是将两个关系的元组合并成一个关系，在合并时去掉重复的元组</li>
</ul>
</li>
<li>差集，设关系R和关系S具有相同的元数n，且相应的属性取自同一个域，则关系R和关系S的差由属于关系R而不属于关系S的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%85%83%E7%BB%84&spm=1001.2101.3001.7020">元组</a>组成，其结果仍为n元的关系<ul>
<li>数学表述：<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/394_8b8_467.gif" class="" title="R - S &#x3D; \{t | t \in R \wedge t \notin S \}">，其中t是元组</li>
</ul>
</li>
</ul>
<p>四种组合操作：</p>
<ul>
<li>交集，设关系R和关系S具有相同的元数n，且相应的属性取自同一个域，则关系R和关系S的交由既属于关系R又属于关系S的元组组成，其结果仍为n元的关系。关系的交可以由关系的差来表示。<ul>
<li>数学描述：<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/421_7c5_097.gif" class="" title="R \cap S&#x3D;\{t\ |\ t \in R \wedge t \in S\}">，其中t是元组</li>
<li><img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/422_243_6ea.gif" class="" title="R \cap S &#x3D; R - (R - S) &#x3D; S - (S - R)"></li>
</ul>
</li>
<li>连接，笛卡尔积+选择的组合<ul>
<li>数学描述：<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/425_d5e_0aa.png" class="" title="img"></li>
</ul>
</li>
<li>自然连接，是一种特殊的等值联接，它要求两个关系中进行比较的分量必须是相同的属性组，并且要在结果中把重复的属性去掉。<ul>
<li>数学描述：<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/430_43b_416.png" class="" title="img"><ul>
<li>自然连接是一种特殊的等值连接</li>
<li>要求关系R和关系S必须有相同的属性组B</li>
<li>R，S属性相同，值必须相等才能连接</li>
<li>要在结果中去掉重复的属性列</li>
</ul>
</li>
</ul>
</li>
<li>除，设两个关系R和S的元数分别为r和s(设r&gt;s&gt;0)，那么R除S是一个(r-s)元的元组的集合。它是满足下列条件的最大关系：其中每个元组t与S中的每个元组u组成的新元组&lt;t,u&gt;必在关系R中。除运算是笛卡尔积的逆运算。<ul>
<li>数学描述：<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/443_06f_27a.gif" class="" title="R \div S &#x3D; \{ t \ | \ t \in \Pi_{R-S} \wedge \forall u \in S \ (tu \in R) \} \\ &#x3D;\Pi_{R-S}(R)-\Pi_{R-S}((\Pi_{R-S}(R) \times S)-R)"></li>
</ul>
</li>
<li>外连接<ul>
<li>定义：两个关系R与S进行连接时，如果关系R（或S）中的元组在S（或R）中找不到相匹配的元组，则为了避免该元组信息丢失，从而将该元组与S（或R）中假定存在的全为空值的元组形成连接，放置在结果关系中，这种连接称之为外连接。</li>
<li>外连接 = 自然连接（<img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/447_d1d_3d6.gif" alt="、theta">或<img src="https://ewr1.vultrobjects.com/imgur2/000/005/605/864_81c_f01.gif" alt="\theta">连接） + 失配的元组（与全空元组形成的连接）</li>
<li>外连接的形式：左外连接、右外连接、全外连接<ul>
<li>左外连接 = 自然连接（<img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/447_d1d_3d6.gif" alt="、theta">或<img src="https://ewr1.vultrobjects.com/imgur2/000/005/605/864_81c_f01.gif" alt="\theta">连接） + 左侧表中失配的元组</li>
<li>右外连接 = 自然连接（<img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/447_d1d_3d6.gif" alt="、theta">或<img src="https://ewr1.vultrobjects.com/imgur2/000/005/605/864_81c_f01.gif" alt="\theta">连接） + 右侧表中失配的元组</li>
<li>全外连接 = 自然连接（<img src="https://ewr1.vultrobjects.com/imgur3/000/009/816/447_d1d_3d6.gif" alt="、theta">或<img src="https://ewr1.vultrobjects.com/imgur2/000/005/605/864_81c_f01.gif" alt="\theta">连接) + 两侧表中失配的元组</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>逻辑优化是基于关系代数等价变换的基础上的优化。主要有以下几个规则：</p>
<ul>
<li>交换律</li>
<li>结合律</li>
<li>分配律</li>
<li>串接率</li>
</ul>
<h2 id="物理优化"><a href="#物理优化" class="headerlink" title="物理优化"></a>物理优化</h2><p>主要流程是枚举各种待选的物理查询路径，并且更加上下文信息计算这些待选路径的代价，进而选择出代价最小的路径。</p>
<blockquote>
<p>执行代价 = IO代价 + CPU代价</p>
</blockquote>
<p>物理优化的四个法宝：</p>
<ul>
<li>B+树，作为索引，对于单值查询和范围查询都有很好的查询效率</li>
<li>Hash表<ul>
<li>用来做分组操作</li>
<li>hash索引，适用于等值约束的查询</li>
<li>Hash join也是join效率非常高的一种方式</li>
</ul>
</li>
<li>排序：<ul>
<li>用来做分组操作</li>
<li>B树索引需要预先排序</li>
<li>Merge join操作第一步需要排序</li>
<li>Order By也需要排序实现</li>
</ul>
</li>
<li>物化，即将中间结果保存下来，优点是可以多次使用。中间结果是否要物化，需要有一个代价计算模型来比较物化和非物化的总体代价</li>
</ul>
<h3 id="物理查询路径生成"><a href="#物理查询路径生成" class="headerlink" title="物理查询路径生成"></a>物理查询路径生成</h3><p>大体上物理查询路径可以分为两种：</p>
<ul>
<li>扫描路径<ul>
<li>顺序扫描</li>
<li>索引扫描</li>
<li>位图扫描</li>
<li>TID扫描，其实是用户提供了tuple的物理位置信息进行扫描</li>
</ul>
</li>
<li>连接路径<ul>
<li>NestLooped Join</li>
<li>Hash Join</li>
<li>Merge Join</li>
</ul>
</li>
</ul>
<p>物理路径搜索方法：</p>
<ul>
<li>自底向上的方法，代表是System-R系统</li>
<li>自顶向下的方法，先构建整个查询逻辑树，然后再迅速枚举各种物理路径</li>
<li>随机搜索，或者叫启发式算法，如遗传算法</li>
</ul>
<h1 id="查询树"><a href="#查询树" class="headerlink" title="查询树"></a>查询树</h1><h2 id="查询树结构体"><a href="#查询树结构体" class="headerlink" title="查询树结构体"></a>查询树结构体</h2><h3 id="Node结构体"><a href="#Node结构体" class="headerlink" title="Node结构体"></a>Node结构体</h3><p>语法树的节点。</p>
<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_164657631336.png" class="" title="img">

<h3 id="Var结构体"><a href="#Var结构体" class="headerlink" title="Var结构体"></a>Var结构体</h3><p>表示查询中涉及到的表中的属性，在语法分析阶段列属性用ColumnRef结构体来表示，在语义分析阶段将ColumnRef结构体替换成Var结构体。</p>
<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16465764293210.png" class="" title="img">

<h3 id="RangeTblEntry（范围表，简称RTE）"><a href="#RangeTblEntry（范围表，简称RTE）" class="headerlink" title="RangeTblEntry（范围表，简称RTE）"></a>RangeTblEntry（范围表，简称RTE）</h3><p>描述了查询中出现的表，除了常规意义上的heap表，还是有子查询、链接表等。即它表示中间组织成Table形式的数据。</p>
<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16465766036438.png" class="" title="img">

<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16465766268823.png" class="" title="img">

<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16465767135544.png" class="" title="img">

<h3 id="RangeTblRef结构体"><a href="#RangeTblRef结构体" class="headerlink" title="RangeTblRef结构体"></a>RangeTblRef结构体</h3><p>是对RangeTblEntry结构体的引用。</p>
<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16465769449013.png" class="" title="img">

<h3 id="JoinExpr结构体"><a href="#JoinExpr结构体" class="headerlink" title="JoinExpr结构体"></a>JoinExpr结构体</h3><p>表示连接的两个表之间的连接关系。</p>
<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16465770657235.png" class="" title="img">

<h3 id="FromExpr结构体"><a href="#FromExpr结构体" class="headerlink" title="FromExpr结构体"></a>FromExpr结构体</h3><p>也是用来表示表之间的连接关系的。不过通常来说该结构体里各个表之间连接关系是inner join。</p>
<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16465773053293.png" class="" title="img">

<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_1646577410553.png" class="" title="img">

<h3 id="Query结构体"><a href="#Query结构体" class="headerlink" title="Query结构体"></a>Query结构体</h3><p>表示查询树。</p>
<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16465777456594.png" class="" title="img">

<p>有三个重要的成员：</p>
<ul>
<li>rtable，在查询中from子句后面会指出需要进行查询的范围表</li>
<li>jointree，列出上面的范围表之间的连接关系，有三种结构体：FromExpr、JoinExpr、RangeTblRef</li>
<li>targelist，包含了需要投影的列</li>
</ul>
<h2 id="查询树的查看"><a href="#查询树的查看" class="headerlink" title="查询树的查看"></a>查询树的查看</h2><img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16465782471397.png" class="" title="img">

<h2 id="执行计划的展示"><a href="#执行计划的展示" class="headerlink" title="执行计划的展示"></a>执行计划的展示</h2><p>explain的语法：</p>
<blockquote>
<p>Explain [(<em>option</em> [,  …])] _statement_</p>
</blockquote>
<p>其中option的选项如下：</p>
<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16465785833314.png" class="" title="img">

<h1 id="逻辑重写优化"><a href="#逻辑重写优化" class="headerlink" title="逻辑重写优化"></a>逻辑重写优化</h1><img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16465792676091.png" class="" title="img">

<h2 id="通用表达式"><a href="#通用表达式" class="headerlink" title="通用表达式"></a>通用表达式</h2><p>即with语句，一般是一次求值，多次使用。所以不对其做提升优化。</p>
<h2 id="子查询提升"><a href="#子查询提升" class="headerlink" title="子查询提升"></a>子查询提升</h2><p>两类：</p>
<ul>
<li>相关子查询：在子查询语句中引用了外层表的列属性，这就导致外层表每获得一个元组，子查询就需要重新查询一次</li>
<li>非相关子查询：子查询和外层表没有关系，子查询可以单独执行一次，外层表可以重复利用子查询的执行结果</li>
</ul>
<p>PG基于子查询所在的位置和作用分类：</p>
<ul>
<li>子链接（SubLink）：以表达式方式存在，出现在Where/On等约束条件中</li>
<li>子查询（SubQuery)：以范围表的方式存在</li>
</ul>
<h3 id="提升子连接"><a href="#提升子连接" class="headerlink" title="提升子连接"></a>提升子连接</h3><p>通常伴随ANY/ALL/IN/EXISTS/SOME等谓词出现。</p>
<p>PG通常对ANY_SUBLINK和EXISTS_SUBLINK两类子链接进行提升。</p>
<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16467492374864.png" class="" title="img">

<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16467492587927.png" class="" title="img">

<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16467493935388.png" class="" title="img">

<blockquote>
<p>大的原则：EXISTS类型的相关子连接会被提升，非相关子连接会形成子执行计划单独求解</p>
</blockquote>
<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16467514112369.png" class="" title="img">



<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16467514795601.png" class="" title="img">

<img src="/2022/03/03/postgresql%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E6%8E%A2%E7%B4%A2/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_16467517335090.png" class="" title="img">

<h3 id="子查询提升-1"><a href="#子查询提升-1" class="headerlink" title="子查询提升"></a>子查询提升</h3><h2 id="Union-ALL"><a href="#Union-ALL" class="headerlink" title="Union ALL"></a>Union ALL</h2><blockquote>
<p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="http://www.noobyard.com/article/p-axhzvgmx-rm.html">数据库系统（4）：关系模型之关系代数</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/xfcy1990/article/details/88736401">关系代数五种基本操作和四程组合操作</a></li>
</ol>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/11/01/duckDB%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/01/duckDB%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">duckDB内存管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-11-01 14:03:29 / 修改时间：16:41:15" itemprop="dateCreated datePublished" datetime="2021-11-01T14:03:29+08:00">2021-11-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>DuckDB 是一款嵌入式列式数据库，主要用于嵌入其他程序执行快速的 SQL 分析查询，官方称其为“分析型数据库中的 SQLite”。DuckDB 易于安装和使用，没有外部依赖，同时提供了 C/C++、Python 以及 R 的语言绑定。</p>
<p>DuckDB 由荷兰 Centrum Wiskunde &amp; Informatica 的数据库架构组开发，他们还开发了 MonetDB（一款开源的列式存储数据库）。DuckDB 采用 MIT 开源协议，并且在 GitHub 上开放了源代码。DuckDB 于 2019 年 6 月 27日首次发布了官方的 0.1 发布版。</p>
<h1 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h1><p>duckDB有一套内存管理模式，基于自己的文件组织结构来做的。</p>
<p>主要涉及的类有：</p>
<ol>
<li>BufferManager<ol>
<li>内存池对外接口，提供内存管理的方法</li>
</ol>
</li>
<li>BlockManager<ol>
<li>块管理器，目前有一个实现是single_file_block_manager</li>
<li>DuckDB的一个数据库就有一个BlockManager进行管理</li>
</ol>
</li>
<li>Filebuffer<ol>
<li>内存缓存块，不一定是固定大小</li>
</ol>
</li>
<li>Block<ol>
<li>继承FileBuffer，固定大小，是块抽象，默认256KB大小</li>
<li>DuckDB认为磁盘sector大小是4KB</li>
</ol>
</li>
</ol>
<h2 id="使用内存管理的地方"><a href="#使用内存管理的地方" class="headerlink" title="使用内存管理的地方"></a>使用内存管理的地方</h2><ol>
<li>多种hashTable<ol>
<li>joinhashTable</li>
<li>baseAggregateHashTable</li>
<li>partitionableHashTable</li>
<li>RadixPartitionedHashTable</li>
</ol>
</li>
<li>排序算法<ol>
<li>MergeSorter</li>
<li>RadixSort</li>
</ol>
</li>
<li>checkpoint<ol>
<li>CheckPointManager<ol>
<li>检查点</li>
</ol>
</li>
</ol>
</li>
<li>MetaBlockReader<ol>
<li>元数据reader</li>
</ol>
</li>
<li>WriteOverflowStringsToDisk<ol>
<li>string类型溢出块</li>
</ol>
</li>
<li>ColumnSegment<ol>
<li>数据列段</li>
</ol>
</li>
</ol>
<h2 id="内存管理BufferManager的接口"><a href="#内存管理BufferManager的接口" class="headerlink" title="内存管理BufferManager的接口"></a>内存管理BufferManager的接口</h2><ol>
<li>RegisterBlock，注册一个block（一般是临时block才会调用这个）</li>
<li>RegisterMemory，注册一个block（临时block），并在内存中分配一块内存关联到这个block</li>
<li>ConvertToPersistent, 把一个block持久化到磁盘中，会用指定的block_id来进行存储数据。</li>
<li>Allocate，（临时block分配）分配指定大小内存buffer，并pin在内存中，这里分配的内存不能小于BlockSize，可以大于一个BlockSize。<ol>
<li>此时Block都是咋管理的？Block都不固定大小了，怎么映射到文件中呢？</li>
<li>超过一个block大小的内存都是临时内存，不用管它跟磁盘的映射？</li>
</ol>
</li>
<li>ReAllocate，扩容，在原有的buffer之上继续扩容，因此每个buffer的大小其实不固定，只是保证是sector的倍数，那也有可能会大于一个BlockSize？看起来也是针对临时内存的分配。</li>
<li>Pin, 把磁盘中内容读取到内存中<ol>
<li>临时内存是在临时文件读取的，每个临时内存都有一个临时文件，读取时直接读取该文件的内容，读完后会删除该文件（这是为啥？之后如果要持久化到内存，会重新申请block_id，这个block_id已经没用了）。（该文件第1~4个字节是内容的长度）</li>
<li>正常内存是在数据文件里读取的，按block_id来计算位置</li>
</ol>
</li>
<li>UnPin，不再对内存中的数据进行使用，可以释放该内存给别人用<ol>
<li>该block引用计数减一</li>
<li>如果该block引用计数为0，加入到弹出队列里</li>
</ol>
</li>
<li>EvictBlock，清理内存<ol>
<li>如果当前使用的内存+需要额外内存大于bufferManager的内存限制<ol>
<li>如果弹出队列为空，表示没有可以释放的内存，那就返回失败了，此时不能再增加内存分配</li>
<li>弹出一个buffer，进行释放到文件中，然后释放内存，指导不再大于bufferManager的内存限制</li>
</ol>
</li>
</ol>
</li>
<li>PurgeQueue，清理弹出队列里被清理的BlockHandle引用</li>
</ol>
<blockquote>
<p>临时Block和正常Block区别：</p>
<ol>
<li>临时Block没有大小限制，不固定，而且是每个Block都放在自己一个单独的临时文件中</li>
<li>正常Block大小固定，是统一放在一个文件中进行管理的。</li>
</ol>
</blockquote>
<h2 id="DuckDB文件块组织方式"><a href="#DuckDB文件块组织方式" class="headerlink" title="DuckDB文件块组织方式"></a>DuckDB文件块组织方式</h2><p>SingleFileBlockManager是把一个文件拆成多个block来进行管理。</p>
<ol>
<li>有三个头部数据块，第一个是MainHeader，主要记录版本和magicnumber，第二和第三个是DataBaseHeader（主要是记录数据相关信息，还有文件里的元数据block链表头，以及数据block链表），两个是为了做checkpoint</li>
<li>MetaBlock，记录的是元数据，例如定义表结构等，还存放了其对应的表数据所在block id</li>
<li>FreeList是记录的空闲列表<ol>
<li>free list就是完全没有被使用的block</li>
<li>modifiedBlock就是被标记删除的block<ol>
<li>一般是自上次checkpoint以来，被删除的block，在本次checkpoint时，会将其加入到free list中，没有做checkpoint前，不会将其二次分配</li>
<li>在每次checkpoint时，还被用来记录哪些block记录的是freeBlockList的元数据</li>
</ol>
</li>
<li>multiUseBlock一般是被多个线程同时使用的block，并且也要被删除，只有最后一个使用者才能真正标记删除它</li>
</ol>
</li>
</ol>
<img src="/2021/11/01/duckDB%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/buffer-16357560755913.png" class="" title="buffer">

<p>如上图所示，文件列表结构如图中所示，meta_block指向的是元数据所在的block_id的列表。</p>
<p>而元数据中有一部分是block_id会指向有正常数据的block列表。</p>
<p>而free_block_id指向的是空闲列表。</p>
<p>内存中数据怎么跟磁盘中block绑定起来的？</p>
<ol>
<li>每次申请一个block，并映射到内存中，如果没写完就插入部分未写完块队列，如果写完就直接刷写到磁盘中，并在内存中记录着block id。</li>
</ol>
<h2 id="数据持久化"><a href="#数据持久化" class="headerlink" title="数据持久化"></a>数据持久化</h2><p>CheckPointManager</p>
<ol>
<li>元数据落盘，包括表结构，以及表的数据所在的block id等信息（实际数据其实已经落盘）。</li>
<li>部分未写完的block落盘（block空闲大于20%），这些数据是在内存中，等待后续进一步写入，这些block会被元数据记录。</li>
</ol>
<h2 id="parquet文件又是怎么支持的呢？"><a href="#parquet文件又是怎么支持的呢？" class="headerlink" title="parquet文件又是怎么支持的呢？"></a>parquet文件又是怎么支持的呢？</h2><ol>
<li>没有走bufferManager这一套，走的是vector，但是vector的内存没有跟bufferManager一样管理起来</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/24/hive-%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/24/hive-%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">hive 测试环境搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-24 09:21:21 / 修改时间：09:50:53" itemprop="dateCreated datePublished" datetime="2021-09-24T09:21:21+08:00">2021-09-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><ol>
<li>参考<a target="_blank" rel="noopener" href="https://bbs.huaweicloud.com/blogs/207331">https://bbs.huaweicloud.com/blogs/207331</a></li>
</ol>
<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><h1 id="hive-beeline-连接报错User-xxx-is-not-allowed-to-impersonate"><a href="#hive-beeline-连接报错User-xxx-is-not-allowed-to-impersonate" class="headerlink" title="hive beeline 连接报错User:xxx is not allowed to impersonate"></a><a target="_blank" rel="noopener" href="https://my.oschina.net/ouminzy/blog/4456727">hive beeline 连接报错User:xxx is not allowed to impersonate</a></h1><h1 id="hive配置遇到的问题（-Relative-path-in-absolute-URI-system-java-io-tmpdir-7D-7Bsystem-user-name-7D"><a href="#hive配置遇到的问题（-Relative-path-in-absolute-URI-system-java-io-tmpdir-7D-7Bsystem-user-name-7D" class="headerlink" title="hive配置遇到的问题（ Relative path in absolute URI: ${system:java.io.tmpdir%7D/$%7Bsystem:user.name%7D"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/zwx19921215/article/details/42776589">hive配置遇到的问题（ Relative path in absolute URI: ${system:java.io.tmpdir%7D/$%7Bsystem:user.name%7D</a></h1>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/12/%E7%BC%96%E8%AF%91zookeeper-c%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/12/%E7%BC%96%E8%AF%91zookeeper-c%E5%BA%93/" class="post-title-link" itemprop="url">编译zookeeper c库</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-08-12 10:33:49 / 修改时间：15:54:20" itemprop="dateCreated datePublished" datetime="2021-08-12T10:33:49+08:00">2021-08-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="编译步骤"><a href="#编译步骤" class="headerlink" title="编译步骤"></a>编译步骤</h1><p>编译目标：zookeeper 3.4.14版本的c库</p>
<p>编译环境：ubuntu 20.04</p>
<p>依赖：cppunit库1.10.2版本，ant编译工具</p>
<h2 id="编译安装cppunit-1-10-2"><a href="#编译安装cppunit-1-10-2" class="headerlink" title="编译安装cppunit 1.10.2"></a>编译安装cppunit 1.10.2</h2><ol>
<li>下载1.10.2版本源码 <a target="_blank" rel="noopener" href="https://osdn.net/projects/sfnet_cppunit/downloads/cppunit/1.10.2/cppunit-1.10.2.tar.gz/">Downloading File /cppunit/1.10.2/cppunit-1.10.2.tar.gz - CppUnit - C++ port of JUnit - OSDN</a></li>
<li>解压源码 tar zxvf cppunit-1.10.2.tar.gz</li>
<li>进入解压后的目录cppunit-1.10.2，执行命令./configure LDFLAGS=’-ldl’  ，不加这个会导致报错 <code>undefined reference to </code>dlsym’` </li>
<li>开始编译make</li>
<li>安装make install</li>
</ol>
<h2 id="编译安装zookeeper-c的动态库"><a href="#编译安装zookeeper-c的动态库" class="headerlink" title="编译安装zookeeper c的动态库"></a>编译安装zookeeper c的动态库</h2><ol>
<li>下载zookeeper 3.4.14源码 wget <a target="_blank" rel="noopener" href="https://github.com/apache/zookeeper/archive/refs/tags/release-3.4.14.tar.gz">https://github.com/apache/zookeeper/archive/refs/tags/release-3.4.14.tar.gz</a></li>
<li>解压缩源码 tar zxvf  zookeeper-release-3.4.14.tar.gz</li>
<li>进入zookeeper解压缩的目录执行命令<ol>
<li><code>ant clean jar</code></li>
<li><code>ant complie_jute</code></li>
</ol>
</li>
<li>进入zookeeper-client/zookeeper-client-c目录执行命令<ol>
<li><code>ACLOCAL=&quot;aclocal -I /usr/local/share/aclocal&quot; autoreconf -if</code></li>
<li><code>mkdir out</code></li>
<li><code>CFLAGS=-Wno-error=format-overflow ./configure --enable-static=yes --enable-shared=yes --prefix=pwd/out --with-pic=yes</code><ol>
<li>不加CFLAGS，会导致gcc9 报错<code>error: &#39;%d&#39; directive writing between 1 and 5 bytes into a region of size</code> </li>
</ol>
</li>
<li><code>make</code></li>
<li><code>make install</code></li>
</ol>
</li>
<li>可以在当前路径下out目录里看到zk开发需要的相关库</li>
</ol>
<h1 id="编写c-代码实现分布式锁"><a href="#编写c-代码实现分布式锁" class="headerlink" title="编写c++代码实现分布式锁"></a>编写c++代码实现分布式锁</h1><p>参考<a target="_blank" rel="noopener" href="https://github.com/hthao/ZKLockGuard">hthao/ZKLockGuard: An implementation of distributed lock with zookeeper. (github.com)</a></p>
<ol>
<li>进入out目录下</li>
<li>然后创建三个文件，一个是main.cpp，另外两个直接下载上面github库的代码，命名为zk_hello.h zk_hello.cpp</li>
<li>编写cmake文件来编译代码</li>
<li>然后去zk上创建/dlock/test目录<ol>
<li>使用zkcli来创建</li>
</ol>
</li>
<li>执行生成的二进制./main，可以看到创建锁成功</li>
</ol>
<p>main.cpp文件如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &quot;zk_hello.h&quot;</span><br><span class="line"></span><br><span class="line">void defaultWatcher(zhandle_t* zh, int type, int state, const char* path, void* watcherCtx) &#123;</span><br><span class="line">        &#x2F;&#x2F;do nothing.</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">zhandle_t* zh &#x3D; NULL;</span><br><span class="line"></span><br><span class="line">bool init(const char* zkHost)</span><br><span class="line">&#123;</span><br><span class="line">        int count &#x3D; 0;</span><br><span class="line">        do &#123;</span><br><span class="line">                count++;</span><br><span class="line">                zh &#x3D; zookeeper_init(zkHost, &amp;defaultWatcher, 10000, 0, NULL, 0);</span><br><span class="line">        &#125; while (!zh &amp;&amp; count &lt; 3);</span><br><span class="line"></span><br><span class="line">        if (!zh) &#123;</span><br><span class="line">                printf(&quot;zookeeper_init failed!!!\n&quot;);</span><br><span class="line">                return false;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">                printf(&quot;zookeeper_init successfully.\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">        if (!init(&quot;172.16.48.4:2181,172.16.48.5:2181,172.16.48.7:2181&quot;)) &#123;</span><br><span class="line">                return -1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">                &#x2F;&#x2F;attemp to lock</span><br><span class="line">                sandsea::ZKLockGuard lock(zh, &quot;&#x2F;dlock&#x2F;test&quot;, &quot;myUniqueString&quot;);</span><br><span class="line">                &#x2F;&#x2F;got the lock,</span><br><span class="line">                &#x2F;&#x2F;do something</span><br><span class="line">                sleep(10);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;lock is released.</span><br><span class="line"></span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>CMakeLists.txt文件如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">project(zk_hello)</span><br><span class="line"></span><br><span class="line">set(CMAKE_CXX_STANDARD 11)</span><br><span class="line"></span><br><span class="line">include_directories($&#123;CMAKE_SOURCE_DIR&#125;&#x2F;include)</span><br><span class="line">link_directories($&#123;CMAKE_SOURCE_DIR&#125;&#x2F;lib)</span><br><span class="line"></span><br><span class="line">add_definitions(&quot;-Wall -g&quot;)</span><br><span class="line">add_executable(main main.cpp zk_hello.cpp)</span><br><span class="line"></span><br><span class="line">target_link_libraries(main pthread zookeeper_mt)</span><br></pre></td></tr></table></figure>


<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/zpxly/article/details/25052357">(11条消息) 编译cppunit出现dlopen未找到_cfmlovers的专栏-CSDN博客</a></li>
<li>[Zookeeper安装后，编译C client时报错”syntax error near unexpected token `1.10.2” - hbg-rohens - 博客园 (cnblogs.com)](<a target="_blank" rel="noopener" href="https://www.cnblogs.com/rohens-hbg/p/12618154.html">https://www.cnblogs.com/rohens-hbg/p/12618154.html</a>)</li>
<li><a target="_blank" rel="noopener" href="https://github.com/XiaoMi/rdsn/pull/667">fix: compile error of zookeeper 3.4.10 on gcc9 by neverchanje · Pull Request #667 · XiaoMi/rdsn (github.com)</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/04/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9001/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/04/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9001/" class="post-title-link" itemprop="url">h2源码分析01</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-04 23:02:47" itemprop="dateCreated datePublished" datetime="2021-08-04T23:02:47+08:00">2021-08-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-03-16 08:45:56" itemprop="dateModified" datetime="2022-03-16T08:45:56+08:00">2022-03-16</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="h2代码架构"><a href="#h2代码架构" class="headerlink" title="h2代码架构"></a>h2代码架构</h1><p>从上到下分为8层：</p>
<ul>
<li>JDBC driver<ul>
<li>jdbc层，源码在org.h2.jdbc, org.h2.jdbcx两个包下</li>
</ul>
</li>
<li>Connection/session management<ul>
<li>链接和会话管理</li>
<li>主要相关类是org.h2.engine.database/session/sessionlocal/sessionremote</li>
</ul>
</li>
<li>SQL Parser.<ul>
<li>词法和语法解析器</li>
<li>使用递归下降算法来进行解析</li>
</ul>
</li>
<li>Command execution and planning.<ul>
<li>命令执行和计划</li>
<li>相关实现在org.h2.command/expression包下，h2没有生成中间层（一般是逻辑计划层），而是直接生成物理执行计划</li>
</ul>
</li>
<li>Table/Index/Constraints.<ul>
<li>表、索引、约束</li>
<li>相关实现在org.h2.index/table/constraint包下</li>
</ul>
</li>
<li>Undo log, redo log, and transactions layer.<ul>
<li>撤销日志，重做日志，事务管理</li>
<li>事务日志是重做日志，所有session共享；撤销日志是每个session一个，主要是为了撤销操作和回滚事务。理论上，事务日志也是可以使用的，不过为了简便，h2当前只使用它自己的“操作列表”（通常在内存中）。对于MVStore，不再需要它（只需要事务日志）</li>
</ul>
</li>
<li>B-tree engine and page-based storage allocation.<ul>
<li>B树和存储管理分配，主要是基于页的分配和B树索引</li>
<li>代码在包org.h2.store里</li>
</ul>
</li>
<li>Filesystem abstraction.<ul>
<li>文件系统抽象，实现可随机访问的文件抽象，方便屏蔽底层内存，磁盘， 或者压缩后的文件的读写</li>
<li>代码在org.h2.store.fs里</li>
</ul>
</li>
</ul>
<h1 id="Server启动服务流程"><a href="#Server启动服务流程" class="headerlink" title="Server启动服务流程"></a>Server启动服务流程</h1><p>以下是h2启动后处理命令，并返回结果会涉及到的主要的类：</p>
<ol>
<li>启动服务是TcpServer</li>
<li>正在处理逻辑是TcpServerThread</li>
<li>TcpServerThread通过SessionLocal来管理跟远程客户端的会话信息</li>
<li>TcpServerThread通过Transfer来跟远程客户端进行消息通信</li>
<li>SessionLocal通过parser来解析语句成Prepared</li>
<li>Prepared准备好要执行的参数和资源，然后生成Command</li>
<li>Command执行后得到Result</li>
<li>TcpServerThread把Result通过Transfer返回给远程客户端</li>
</ol>
<img src="/2021/08/04/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9001/TcpServer.png" class="" title="TcpServer">



<p>Server类和service类</p>
<p>Server类是用来启动对应的服务的，默认启动三个：</p>
<ol>
<li>TcpServer：主要用来接受远程链接的，支持h2自己的协议</li>
<li>PgServer：也是用来接收远程链接的，支持pg的协议</li>
<li>WebServer：主要是webconsole，在网页可以直接请求访问一个本地或者远程的h2</li>
</ol>
<img src="/2021/08/04/h2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%9001/Service-16283493788731.png" class="" title="Service">



<h2 id="transfer类"><a href="#transfer类" class="headerlink" title="transfer类"></a>transfer类</h2><p>主要是用来封装下数据socket，提供一些网络流对于不同基础数据类型的读写函数</p>
<h2 id="TcpServer类"><a href="#TcpServer类" class="headerlink" title="TcpServer类"></a>TcpServer类</h2><p>初始化启动时，调用start方法：</p>
<ol>
<li>挑选一个合适的端口进行监听</li>
<li>创建管理session的内存数据库</li>
<li>创建关闭数据库的函数</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">       stop = <span class="keyword">false</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           serverSocket = NetUtils.createServerSocket(port, ssl);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (DbException e) &#123;</span><br><span class="line">           <span class="keyword">if</span> (!portIsSet) &#123;</span><br><span class="line">               serverSocket = NetUtils.createServerSocket(<span class="number">0</span>, ssl);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">throw</span> e;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       port = serverSocket.getLocalPort(); <span class="comment">// 随机获取一个端口</span></span><br><span class="line">       initManagementDb();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initManagementDb</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (managementPassword.isEmpty()) &#123;</span><br><span class="line">           managementPassword = StringUtils.convertBytesToHex(MathUtils.secureRandomBytes(<span class="number">32</span>));</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// avoid using the driver manager</span></span><br><span class="line">       JdbcConnection conn = <span class="keyword">new</span> JdbcConnection(<span class="string">&quot;jdbc:h2:&quot;</span> + getManagementDbName(port), <span class="keyword">null</span>, <span class="string">&quot;&quot;</span>, managementPassword);</span><br><span class="line">       managementDb = conn;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> (Statement stat = conn.createStatement()) &#123;</span><br><span class="line">           stat.execute(<span class="string">&quot;CREATE ALIAS IF NOT EXISTS STOP_SERVER FOR &#x27;&quot;</span> + TcpServer.class.getName() + <span class="string">&quot;.stopServer&#x27;&quot;</span>); <span class="comment">// 创建自定义函数，用来支持通过发命令停止h2数据库</span></span><br><span class="line">           stat.execute(<span class="string">&quot;CREATE TABLE IF NOT EXISTS SESSIONS&quot;</span> +</span><br><span class="line">                   <span class="string">&quot;(ID INT PRIMARY KEY, URL VARCHAR, `USER` VARCHAR, &quot;</span> +</span><br><span class="line">                   <span class="string">&quot;CONNECTED TIMESTAMP(9) WITH TIME ZONE)&quot;</span>);</span><br><span class="line">           managementDbAdd = conn.prepareStatement(</span><br><span class="line">                   <span class="string">&quot;INSERT INTO SESSIONS VALUES(?, ?, ?, CURRENT_TIMESTAMP(9))&quot;</span>);</span><br><span class="line">           managementDbRemove = conn.prepareStatement(</span><br><span class="line">                   <span class="string">&quot;DELETE FROM SESSIONS WHERE ID=?&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       SERVERS.put(port, <span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>


<p>另外一个就是监听方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listen</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        listenerThread = Thread.currentThread();</span><br><span class="line">        String threadName = listenerThread.getName();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (!stop) &#123;</span><br><span class="line">                Socket s = serverSocket.accept();</span><br><span class="line">                Utils10.setTcpQuickack(s, <span class="keyword">true</span>);  <span class="comment">// 用来降低小包的延迟的，防止nagle算法优化导致网络小包数据传输延迟比较高</span></span><br><span class="line">                <span class="keyword">int</span> id = nextThreadId++;</span><br><span class="line">                TcpServerThread c = <span class="keyword">new</span> TcpServerThread(s, <span class="keyword">this</span>, id);</span><br><span class="line">                running.add(c);</span><br><span class="line">                Thread thread = <span class="keyword">new</span> Thread(c, threadName + <span class="string">&quot; thread-&quot;</span> + id);</span><br><span class="line">                thread.setDaemon(isDaemon); <span class="comment">// 启动一个后台线程进行处理链接请求</span></span><br><span class="line">                c.setThread(thread);</span><br><span class="line">                thread.start();</span><br><span class="line">            &#125;</span><br><span class="line">            serverSocket = NetUtils.closeSilently(serverSocket);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!stop) &#123;</span><br><span class="line">                DbException.traceThrowable(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stopManagementDb();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="TcpServerThread类"><a href="#TcpServerThread类" class="headerlink" title="TcpServerThread类"></a>TcpServerThread类</h2><p>两个重要方法：</p>
<ol>
<li>run，启动函数，主要是根据跟client的链接进行一些检查和设置</li>
<li>process，循环处理client的请求<ol>
<li>处理来自客户端的一些命令，总有19条，其中process只处理其中的17条，run函数里处理剩下的两个。从大到小共分成三类：<ol>
<li>Session级</li>
<li>Command级</li>
<li>Result级</li>
</ol>
</li>
</ol>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_PREPARE = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_CLOSE = <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COMMAND_EXECUTE_QUERY = <span class="number">2</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COMMAND_EXECUTE_UPDATE = <span class="number">3</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COMMAND_CLOSE = <span class="number">4</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RESULT_FETCH_ROWS = <span class="number">5</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RESULT_RESET = <span class="number">6</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RESULT_CLOSE = <span class="number">7</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COMMAND_COMMIT = <span class="number">8</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CHANGE_ID = <span class="number">9</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COMMAND_GET_META_DATA = <span class="number">10</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_PREPARE_READ_PARAMS = <span class="number">11</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_SET_ID = <span class="number">12</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_CANCEL_STATEMENT = <span class="number">13</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_CHECK_KEY = <span class="number">14</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_SET_AUTOCOMMIT = <span class="number">15</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_HAS_PENDING_TRANSACTION = <span class="number">16</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LOB_READ = <span class="number">17</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_PREPARE_READ_PARAMS2 = <span class="number">18</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> GET_JDBC_META = <span class="number">19</span>;</span><br></pre></td></tr></table></figure>


<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://www.h2database.com/html/architecture.html">Architecture (h2database.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/codefollower/H2-Research/blob/master/h2/src/main/org/h2/server/TcpServer.java">H2-Research/TcpServer.java at master · codefollower/H2-Research (github.com)</a></li>
<li><a target="_blank" rel="noopener" href="http://www.h2database.com/html/commands.html#create_schema">http://www.h2database.com/html/commands.html#create_schema</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/29/SQLite%E9%A1%B5%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/29/SQLite%E9%A1%B5%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97/" class="post-title-link" itemprop="url">SQLite页管理模块</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-07-29 23:15:31 / 修改时间：23:17:20" itemprop="dateCreated datePublished" datetime="2021-07-29T23:15:31+08:00">2021-07-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Pager模块概览"><a href="#Pager模块概览" class="headerlink" title="Pager模块概览"></a>Pager模块概览</h1><p>承担四个功能：</p>
<ol>
<li>锁管理</li>
<li>事务管理</li>
<li>日志管理</li>
<li>数据管理</li>
</ol>
<p><img src="C:/Users/94121/AppData/Local/Temp/企业微信截图_1627571797387.png" alt="img"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2021 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason Chao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
