<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.2.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>
<meta property="og:type" content="website">
<meta property="og:title" content="我住8楼">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="我住8楼">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Jason Chao">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>
<title>我住8楼</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">我住8楼</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jason Chao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/29/stl%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-%E8%BF%AD%E4%BB%A3%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/29/stl%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-%E8%BF%AD%E4%BB%A3%E5%99%A8/" class="post-title-link" itemprop="url">stl源码剖析-迭代器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-01-29 15:15:35 / 修改时间：16:40:16" itemprop="dateCreated datePublished" datetime="2021-01-29T15:15:35+08:00">2021-01-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/stl/" itemprop="url" rel="index"><span itemprop="name">stl</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Traits编程技法"><a href="#Traits编程技法" class="headerlink" title="Traits编程技法"></a>Traits编程技法</h1><blockquote>
<p>偏特化（partial specialization）：如果class template拥有一个以上的template参数，我么可以针对其中某个（或数个，但非全部）template参数进行特化工作。即，在泛化设计中提供一个特化版本。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">template &lt;class T&gt;</span><br><span class="line">struct iterator_traits &#123;</span><br><span class="line">    typedef typename T::iterator_category iterator_category;  &#x2F;&#x2F; 遍历策略：只读，只写，允许写入型算法读写操作，双向移动，随机读写</span><br><span class="line">    typedef typename T::value_type        value_type;   &#x2F;&#x2F; 值类型</span><br><span class="line">    typedef typename T::difference_type   difference_type;  &#x2F;&#x2F; 两个迭代器之间距离类型</span><br><span class="line">    typedef typename T::pointer           pointer;   &#x2F;&#x2F; 迭代器所指类型指针：左值</span><br><span class="line">    typedef typename T::reference         reference;  &#x2F;&#x2F; 值引用类型： 左值</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 上面是stl中迭代器需要指定的几种数据类型，函数模板通过这几种模板类型来操作相关数据，</span><br><span class="line">而真正的数据对象类型会根据传入的数据类型进行相应的调整。</span><br><span class="line"> </span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">template &lt;class T&gt;</span><br><span class="line">struct flag_traits &#123;</span><br><span class="line">    typedef typename T::value_type   value_type;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">struct B_tag &#123;&#125;;</span><br><span class="line">struct D1_tag ：public B_tag &#123;&#125;;</span><br><span class="line">struct D2_tag : public D1_tag &#123;&#125;;</span><br><span class="line"> </span><br><span class="line">template &lt;class I&gt;</span><br><span class="line">func(I&amp; p, B_tag) &#123;</span><br><span class="line">    cout &lt;&lt; &quot; B version &quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">template &lt;class I&gt;</span><br><span class="line">func(I&amp; p, D2_tag) &#123;</span><br><span class="line">    cout &lt;&lt; &quot; D2 version &quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">template &lt;class I&gt;</span><br><span class="line">func(I&amp; p) &#123;</span><br><span class="line">    func(p, typename flag_traits&lt;I&gt;::value_type());</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">class B &#123;</span><br><span class="line">    typedef B_tag  value_type;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">class D1 &#123;</span><br><span class="line">    typedef D1_tag value_type;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">class D2 &#123;</span><br><span class="line">    typedef D2_tag  value_type;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">int main() &#123;</span><br><span class="line">    B b;</span><br><span class="line">    D1 d1;</span><br><span class="line">    D2 d2;</span><br><span class="line">    func(b);</span><br><span class="line">    func(d1);</span><br><span class="line">    func(d2);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">可以通过flag_traits::value_type的方式来推导当前调用的函数是哪个函数的重载。</span><br><span class="line">这种通过设定一个模板类，间接推导参数类型的方式值得学习。</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/29/stl%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-allocator%E7%A9%BA%E9%97%B4%E5%88%86%E9%85%8D%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/29/stl%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-allocator%E7%A9%BA%E9%97%B4%E5%88%86%E9%85%8D%E5%99%A8/" class="post-title-link" itemprop="url">stl源码剖析-allocator空间分配器</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-01-29 15:14:27 / 修改时间：16:40:04" itemprop="dateCreated datePublished" datetime="2021-01-29T15:14:27+08:00">2021-01-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/stl/" itemprop="url" rel="index"><span itemprop="name">stl</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="一二级分配器"><a href="#一二级分配器" class="headerlink" title="一二级分配器"></a>一二级分配器</h1><p>sgi stl为了内存分配效率，采用了两级分配器。</p>
<h2 id="第一级分配器"><a href="#第一级分配器" class="headerlink" title="第一级分配器"></a>第一级分配器</h2><p>template<br>class __malloc_alloc_template {…};<br>其中：</p>
<ol>
<li>allocate()直接使用malloc(), deallocate()直接使用free()。</li>
<li>模拟c++的set_new_handler()以处理内存不足的情况</li>
</ol>
<h2 id="第二级分配器"><a href="#第二级分配器" class="headerlink" title="第二级分配器"></a>第二级分配器</h2><p>template<br>class __default_alloc_template {…};<br>其中：</p>
<ol>
<li>维护16个自由链表（free lists），负责16种小型区块的次配置能力。内存池以malloc配置而得，如果内存不足，转调用第一级分配器（那里有处理程序）。</li>
<li>如果需求的区块大于128 bytes, 就转调用第一级分配器。</li>
</ol>
<h2 id="内存管理小技巧"><a href="#内存管理小技巧" class="headerlink" title="内存管理小技巧"></a>内存管理小技巧</h2><p>第二级分配器管理的16个自由链表的时候，对于每个块，采用了如下所示数据结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">union obj &#123;</span><br><span class="line">    union obj* free_list_link;</span><br><span class="line">    char client_data[1];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ol>
<li>当分配出去时，用户看到的是client_data部分，丝毫不浪费空间</li>
<li>当空闲时，可以设置free_list_link将各个空闲块链接起来</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/29/%E6%8A%95%E8%B5%84%E5%AD%A6%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/29/%E6%8A%95%E8%B5%84%E5%AD%A6%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">投资学记录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-29 15:12:51" itemprop="dateCreated datePublished" datetime="2021-01-29T15:12:51+08:00">2021-01-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-02-07 17:35:36" itemprop="dateModified" datetime="2021-02-07T17:35:36+08:00">2021-02-07</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>读《手把手教你读财报》—唐朝</p>
</blockquote>
<p>术语解释：</p>
<ol>
<li>少数股东权益<ul>
<li>子公司里占点股份的股东，他们股份对应的资产</li>
</ul>
</li>
<li>少数股东损益<ul>
<li>占点股份的股东对应的股份的利润或亏损，在利润表里就叫“少数股东损益</li>
</ul>
</li>
<li>归属于母公司所有者的净利润<ul>
<li>从净利润里去掉了它（少数股东损益），剩下部分，便是报告期内上市公司股东拥有的净利润</li>
</ul>
</li>
<li>每股收益<ul>
<li>归属于母公司所有者的净利润除以公司总股本，就得出研究机构和股评人士最喜欢讨论的“每股收益”</li>
</ul>
</li>
<li>PE，即市盈率，股票价格/每股收益</li>
<li>盈余公积金<ul>
<li>盈余公积金是法律不让公司分配的利润。中国的《公司法》规定，一个公司盈利后，必须留存至少10%作为盈余公积。这是一个具有“中国特色”的科目，是政府强制公司进行扩大再生产的手段。按法律规定，盈余公积累计超过注册资金的50%后，由董事会自行决定是否继续计提。盈余公积一旦计提，用途就受限制了，只能用于弥补经营亏损，或派送红股。后者还要保证送股后，盈余公积仍然大于注册资本的25%。</li>
</ul>
</li>
<li>一般风险准备<ul>
<li>一般风险准备，是专门要求金融企业提取的款项，用于弥补未来“莫须有（可能有）”的亏损。</li>
</ul>
</li>
<li>未分配利润<ul>
<li>是从历年净利润总和中，去掉计提盈余公积和分红后的剩余。</li>
</ul>
</li>
<li>现金及现金等价物<ul>
<li>现金及现金等价物包括库存现金、银行存款、其他货币资金、存放中央银行可随时支取的备付金、存放同业款项、拆放同业款项、同业间买入返售证券，以及企业持有的期限短（一般指从购买日起三个月内到期）、流动性强、易于转换为已知金额现金、价值变动风险很小的投资。</li>
</ul>
</li>
<li>增值税<ul>
<li>增值税是中国第一大税种，它的75%归中央政府所有，25%归地方政府所有;对上市公司而言，增值税率主要有17%、13%和0三档。增值税是流转税，无论是否盈利，只要涉及商品生产、批发、零售和进口活动，都要缴纳增值税。</li>
</ul>
</li>
<li>贴现<ul>
<li>贴现：指持票人在汇票到期前，为了取得资金，贴付一定利息将票据收款权转让给银行的行为。贴现是银行出借资金的方式之一。</li>
<li>转贴现：指银行在资金临时不足时，将已经贴现但仍未到期的票据，交给其他银行或贴现机构获取资金的行为。</li>
<li>再贴现：指中央银行通过买进银行持有的已贴现但尚未到期的票据，向银行提供资金支持的行为。</li>
<li>贴现率：在人民银行现行的再贴现利率的基础上上浮。贴现率是一种市场价格，由双方协商确定，一般不会超过现行贷款利率。</li>
</ul>
</li>
<li>融资租凭<ul>
<li>就是公司买个大件（如挖掘机、大货车、厂房、机床等）租给需要用这个东西的企业A，双方约定A每年或每月支付多少租金，N年或N月后，按照某价格把旧设备或厂房卖给A。租金加上旧货成交价之和大于最初买价的部分，相当于是A为这笔借款支付的利息。</li>
</ul>
</li>
<li>递延方式分期收款<ul>
<li>理解为公司卖了货（或提供了劳务）给企业A，收到全部款项后，又把这笔款子借给A用，然后A按约定利率付息。</li>
</ul>
</li>
<li>市净率PB（股价/净资产）</li>
<li>所有者权益<ul>
<li>由公司总资产减去总负债得出。所有者权益主要由四部分组成，即实收资本、资本公积、盈余公积和未分配利润。</li>
</ul>
</li>
<li>资本公积<ul>
<li>股东投入的超过股本的部分，不是由企业利润形成的。</li>
</ul>
</li>
<li>营业成本<ul>
<li>就是报表期内公司为了销售，而从资产负债表存货科目里搬走存货的价值。</li>
</ul>
</li>
<li>营业收入<ul>
<li>主业经营所得。</li>
</ul>
</li>
<li>净资产收益率, ROE<ul>
<li>净利润÷平均净资产</li>
</ul>
</li>
<li>自由现金流<ul>
<li>是企业经营活动流入现金净额，减去维持现有生意运转必需的现金投入。实践中一般用财报“经营现金流入净额-投资活动现金流出”来毛估。</li>
</ul>
</li>
</ol>
<h1 id="必须要学会读财报"><a href="#必须要学会读财报" class="headerlink" title="必须要学会读财报"></a>必须要学会读财报</h1><p>财报是了解一个公司最基本的信息来源，需要通过这个来对公司现状有个清楚的认识。财报是分析公司的起点，投资者应深刻认识行业及企业的特性，再结合财报数据，才可能做出正确的决定。而认识行业和企业，阅读财报是必经之路，大量阅读行业内重要企业的财报，是取得投资比较优势的重要途径。</p>
<blockquote>
<p>按规定，年报要求年度结束后4个月内披露；半年报要求在上半年结束后2个月内披露；第一季度、第三季度季报，要求在季度结束后1个月内披露。因此，年报准备时间最充分，信息披露最详细，可信度最高。半年报次之。至于一季报、三季报，相对简单，仅供投资者了解基本数据。</p>
</blockquote>
<p>财报最重要的内容：</p>
<ol>
<li>财务会计报告</li>
<li>董事会报告</li>
<li>重要事项</li>
</ol>
<p>考虑到财报可能造假，详细读之前需要判断下财报真实可信度：</p>
<table>
<thead>
<tr>
<th align="left">会计师出具意见</th>
<th align="left">真实意思</th>
</tr>
</thead>
<tbody><tr>
<td align="left">标准无保留意见的审计报告</td>
<td align="left">造假迹象未被本人发现</td>
</tr>
<tr>
<td align="left">附带说明的标准无保留意见的审计报告</td>
<td align="left">黑锅有人背，本人大胆拿钱</td>
</tr>
<tr>
<td align="left">保留意见的审计报告</td>
<td align="left">假报表，别看了</td>
</tr>
<tr>
<td align="left">无法出具意见审计报告</td>
<td align="left">本人拒绝和挫劣的骗子合作</td>
</tr>
<tr>
<td align="left">否定意见审计报告</td>
<td align="left">本人举报诈骗犯</td>
</tr>
</tbody></table>
<h1 id="资产负债表"><a href="#资产负债表" class="headerlink" title="资产负债表"></a>资产负债表</h1><h2 id="资产"><a href="#资产" class="headerlink" title="资产"></a>资产</h2><h3 id="货币资金"><a href="#货币资金" class="headerlink" title="货币资金"></a>货币资金</h3><p>货币资金包括：现金及现金等价物，以及使用受限制的资金</p>
<p>对公司而言，通常有三种途径可以产生货币资金。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 发售股票或举债；</span><br><span class="line">2. 出售资产或业务部门；</span><br><span class="line">3. 经营活动的现金流入持续大于现金流出。</span><br></pre></td></tr></table></figure>
<p>符合第三种情况的公司，通常都具有某种持续性竞争优势。</p>
<p><strong>注意点</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">货币资金需要与短期债务及经营需要相匹配。与短期债务的匹配情况，代表企业的偿债能力。与经营需要的匹配情况，代表企业的资金运用能力。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实践中投资者要注意以下四种情况：</p>
<ol>
<li>货币资金余额比短期负债小很多；</li>
<li>货币资金充裕，却借了很多有息甚至高息负债；</li>
<li>定期存款很多，其他货币资金很多，流动资金却严重缺乏；</li>
<li>其他货币资金数额巨大，但没有合理解释。</li>
</ol>
<p>正所谓“事有反常必为妖”。以上状态中，情形（1）可能代表公司有短期偿债危机，情形（2）（3）（4）则意味着貌似充裕的货币资金，可能存在虚构、冻结，或者早就被大股东占用，只是在报表日前几天回到公司账上，过后又会消失。这几条，都是老唐排除公司的重要准则。</p>
</blockquote>
<h3 id="经营相关资产"><a href="#经营相关资产" class="headerlink" title="经营相关资产"></a>经营相关资产</h3><ol>
<li><p>应收票据</p>
<ol>
<li><p>应收票据全部由银行承兑汇票组成，证明企业地位强势，产品抢手；</p>
</li>
<li><p>有大量的商业承兑汇票，则说明企业采用相对宽松的销售政策；</p>
</li>
<li><p>银行承兑汇票 &gt; 商业承兑汇票</p>
<p><strong>注意</strong>：</p>
<p>如果一家非金融企业报表里有与正常经营规模不匹配的应收票据，那么，这家公司很可能是在票据市场当炒家，也算是不务正业，投资者需要对其提高警惕。</p>
</li>
</ol>
</li>
<li><p>应收账款（白条子，即欠条）</p>
<ol>
<li><p>总体来说，就公司经营稳健度和产品竞争力而言，从优到劣，可以排序为现金、银行承兑汇票、商业承兑汇票、应收账款。</p>
</li>
<li><p>计提坏账准备（账龄分析法，余额百分比法，摊余成本估算法）</p>
<p><strong>注意</strong>：</p>
<ol>
<li>如果一家企业应收账款大幅增长，增长幅度超过同期收入增长，应收账款回款速度（应收账款/平均每日销售收入）低于行业平均水平，或呈现明显下降趋势，往往预示着两种可能：公司临时放宽了信用政策，加大赊销力度；或公司提前确认收入甚至虚构收入。</li>
<li>另外，如果公司应收账款占收入的比例比较大，且有很大部分（如超过三成）是一年以上应收款，此种情况下，投资者就需要警惕公司收入的真实性。</li>
<li>若是产品名不见经传，市场竞争激烈，同类替代产品多如牛毛，居然也没有应收款。那会是什么情况？收入造假！</li>
<li>以客户名义打进来一笔钱将应收款收回，然后以别的名义将钱转出去</li>
</ol>
</li>
</ol>
</li>
<li><p>预付账款</p>
<ol>
<li><p>如果过大，就是在商业生态链地位低或者信用不好</p>
<p><strong>注意</strong>：</p>
<ol>
<li>投资者需要持续关注公司历年预付款占营业收入或营业成本的比例。如果该比例发生大幅波动，就需要寻找合理解释。无法找到合理解释的，投资者就要考虑防假、防雷措施。</li>
</ol>
</li>
</ol>
</li>
<li><p>应收利息和应收股息</p>
</li>
<li><p>其他应收款</p>
<ol>
<li>与主业务无关的应收款</li>
<li>越少越好</li>
</ol>
</li>
<li><p>长期应收款</p>
<ol>
<li>指企业融资租赁产生的应收款项和采用递延方式分期收款</li>
</ol>
</li>
<li><p>存货</p>
<ol>
<li><p>存货的计价方式：先进先出法、后进先出法、加权平均法和个别计价法。</p>
<p><strong>注意</strong>：</p>
<ol>
<li>是通过虚构商品采购流出资金，再将资金流回企业、虚增利润；这种造假，往往伴随存货增长大幅超过同期营业成本增长幅度，且所备存货与企业销售速度相比，显著高于同行业水平。</li>
<li>是通过加大生产，降低单位产品的成本，从而欺诈性地提升毛利率，虚增本期利润。</li>
</ol>
</li>
</ol>
</li>
<li><p>生物资产</p>
<ol>
<li>造假高发区</li>
</ol>
</li>
</ol>
<table>
<thead>
<tr>
<th align="left">科目</th>
<th align="left">重点关注</th>
</tr>
</thead>
<tbody><tr>
<td align="left">应收票据</td>
<td align="left">银行承兑票据&gt;商业承兑票据</td>
</tr>
<tr>
<td align="left">应收账款</td>
<td align="left">增长幅度和坏账准备计提政策</td>
</tr>
<tr>
<td align="left">其他应收款</td>
<td align="left">越少越好</td>
</tr>
<tr>
<td align="left">存货</td>
<td align="left">存货和营业成本的合理比例</td>
</tr>
</tbody></table>
<h3 id="生产相关资产"><a href="#生产相关资产" class="headerlink" title="生产相关资产"></a>生产相关资产</h3><ol>
<li><p>固定资产</p>
<ol>
<li>固定资产要计提折旧。</li>
<li>除了折旧，固定资产年末（或季度末）还需要进行减值测试（比如原来的产品降价，导致按原有价格折旧后价格还比降价后的高，就得减去这个差值）。</li>
<li>折旧政策有好几种（年限平均法、工作量法、双倍余额递减法和年数总和法等），公司使用哪种，对投资者而言，无须深究。</li>
<li>因为折旧算费用，需要从利润表里扣除，会减少当期利润，从而减少当期所得税，所以，优秀的公司一般倾向于使用快速折旧的方法，以增加前期费用，减少前期利润。</li>
<li>折旧并不意味着资产真的产生损失了。</li>
</ol>
</li>
<li><p>在建工程和工程物资</p>
<p><strong>注意</strong>：</p>
<p>在建工程不需要计提折旧，因此，如果一家公司在建工程数目巨大，迟迟不转入固定资产科目，投资者一般就需要对其持怀疑态度。出现此种情况存在两种可能性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 工程已经完工并投入使用了，但公司为了避免折旧，美化当期利润，而不将其转入固定资产。</span><br><span class="line">2. 有些公司，通过在建工程将公司的钱支付给虚构或关联的供应商，然后再以采购公司商品或服务的名义，变成收入流回公司。这种在建工程，最后往往通过大比例折旧或者以意外损毁等名义，计提高额减值损失，光明正大地“毁尸灭迹”。</span><br></pre></td></tr></table></figure></li>
<li><p>无形资产</p>
<ol>
<li>包括专利权、商标权、著作权、土地使用权、特许权、版权和非专利技术等。也进行折旧，术语为摊销。</li>
</ol>
</li>
<li><p>商誉</p>
<ol>
<li>若一家企业的获利能力超过可辨认净资产的正常获利能力，超出的部分，一定是另外一种资产带来的，这个资产就被叫作“商誉”</li>
<li>商誉不用摊销，改为做减值测试，一旦减值处理，以后不能再转回来</li>
</ol>
</li>
<li><p>长期待摊费用</p>
<ol>
<li>企业已经支出的但功效持续一年以上的费用，常见的主要是对固定资产的改良费用。</li>
<li>将费用算成长期待摊费用，假装它是一笔资产，公司资产质量差</li>
</ol>
</li>
<li><p>递延所得税资产和负债</p>
<ol>
<li><p>递延所得税资产（税务局算的公司利润大于公司计算的利润，税比公司算的高）</p>
<ol>
<li>有些费用，虽然公司实际支出或提列了，但税务局根据政策法规不认可。</li>
<li>有些公司本期一次性支出的费用，但按照税务局的规定，只能在以后分批扣除，如坏账准备、修理和保修费用、超过年度营收15%的广告费等；而有些收入，被税务局认定为本期收入，但按照公司财务政策，需要在下期才报告</li>
<li>内部公司之间销售的影响。</li>
<li>公允价值波动损益产生的所得税差异</li>
</ol>
</li>
<li><p>递延所得税负债</p>
<ol>
<li>有些费用（例如研发费用），按照公司会计政策分摊在多年里，但根据税务制度，却可以在当年全额税前抵扣；也有些费用，按照政策可以多算，如企业雇佣残疾人，残疾人的工资可以双倍算进费用里。</li>
<li>某些被公司计入本期的收入，而税务局认为应该分几期纳税。</li>
<li>政府有时为了鼓励某些行业，允许某些行业的某些资产，采用加速折旧法折旧，而公司报表上可能是按照直线折旧法折的。由此，税务局认定的费用就可能比公司算的大。</li>
<li>公允价值波动损益产生的所得税差异。</li>
</ol>
<p><strong>注意</strong>：</p>
<ol>
<li>我国所得税率，现在基本上统一为25%了。只有很少一部分高新技术企业享受15%的所得税率。</li>
<li>按税法及相关规定计算的当期所得税”数字除以25%，大致可以推算出税务局认定的当年企业税前利润。长期看，这个数据应该和公司净利润保持相对稳定的比例。如果相差较大，就需要投资者警惕公司是否存在大幅调节利润的情况。</li>
</ol>
</li>
</ol>
</li>
<li><p>其他流动资产和非流动资产</p>
<ol>
<li>周转期不超过一年的资产，归入其他流动资产；超过一年的，就放入其他非流动资产</li>
</ol>
</li>
</ol>
<table>
<thead>
<tr>
<th align="left">科目</th>
<th align="left">重点关注</th>
</tr>
</thead>
<tbody><tr>
<td align="left">固定资产</td>
<td align="left">年年折旧，折旧算费用</td>
</tr>
<tr>
<td align="left">在建工程</td>
<td align="left">迟迟不转为资产，肯定有鬼</td>
</tr>
<tr>
<td align="left">无形资产</td>
<td align="left">研发费用，可能是机会也可能是陷阱</td>
</tr>
<tr>
<td align="left">商誉</td>
<td align="left">没有数字不代表没有商誉</td>
</tr>
<tr>
<td align="left">长期待摊费用</td>
<td align="left">越小越好</td>
</tr>
<tr>
<td align="left">递延所得税资产</td>
<td align="left">税务局收的税&gt;公司算的税</td>
</tr>
<tr>
<td align="left">递延所得税负债</td>
<td align="left">税务局收的税&lt;公司算的税</td>
</tr>
</tbody></table>
<h3 id="投资相关资产"><a href="#投资相关资产" class="headerlink" title="投资相关资产"></a>投资相关资产</h3><ol>
<li><p>交易性金融资产</p>
<ol>
<li>债券、股票、基金、权证等金融资产</li>
</ol>
</li>
<li><p>持有至到期投资</p>
<p><strong>注意</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 进行大额减值。当发现持有的投资有确定证据发生减值时，对其计提减值是一种谨慎的态度。但也非常有可能是公司首先虚构了收入和利润，然后购入掺水的持有至到期投资，再通过减值“毁尸灭迹”。2. 是减值的转回。债权类的减值，当减值迹象消失后，是可以转回的。对以往减值的转回，可能真是减值测试错误估计了形势，也可能代表企业对当期利润的操纵意图。</span><br><span class="line">3. 是重分类。持有至到期投资，可以和可供出售金融资产相互重分类。当持有至到期投资被企业改变为可供出售金融资产后，将从摊余成本计量变为公允价值计量。重分类日的公允价值和账面价值的差额，计入资产负债表的资本公积科目。</span><br></pre></td></tr></table></figure></li>
<li><p>可供出售金融资产</p>
<ol>
<li>跟交易性金融资产非常类似，采用公允价值计量。但不一样的是，可供出售金融资产的公允价值变动不计入企业当期利润，而是计入权益科目下的资本公积的变动，其影响净资产，不影响利润。因为不进入利润表，所以也不涉及纳税问题。等卖出时，卖价与最初的买价的差额计入当期利润表，同时从资本公积项目里去掉该项资产历年累积的资本公积。</li>
</ol>
</li>
<li><p>长期股权投资</p>
<ol>
<li>上市公司持有子公司的股权，按照成本法核算，体现于母公司报表里。制作合并报表时，需要全部转换成权益法核算。因而子公司的经营情况，是合并报表利润及资产负债变化的重要组成。然而，对母公司报表的影响，则仅限于宣布的分红额。</li>
<li>同样的一笔股权买卖，如果是同一控制下的交易，不会影响利润。而不同控制下的，则会影响利润。</li>
</ol>
</li>
</ol>
<table>
<thead>
<tr>
<th align="left">关系</th>
<th align="left">持股比例</th>
<th align="left">核算方法</th>
<th align="left">所持股权对利润表的影响</th>
</tr>
</thead>
<tbody><tr>
<td align="left">控制</td>
<td align="left">50%以上</td>
<td align="left">成本法</td>
<td align="left">宣布的分红，进入利润表</td>
</tr>
<tr>
<td align="left">合营</td>
<td align="left">合同约定</td>
<td align="left">权益法</td>
<td align="left">按持股比例确认持股对象的经营盈亏</td>
</tr>
<tr>
<td align="left">联营</td>
<td align="left">20%~50%</td>
<td align="left">权益法</td>
<td align="left">按持股比例确认持股对象的经营盈亏</td>
</tr>
<tr>
<td align="left">其他</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">按照可供出售或交易性资产对待</td>
</tr>
</tbody></table>
<ol>
<li><p>买入返售金融资产</p>
<ol>
<li>抵押贷款</li>
</ol>
</li>
<li><p>投资性房地产</p>
<ol>
<li><p>投资性房地产，可以选择用成本模式计量，也可以选择用公允价值模式（简单理解为市价）计量；一般来说，会计规则建议企业采用成本模式计量投资性房地产。</p>
<p><strong>注意</strong>：</p>
<ol>
<li>对某些同行业公司之间（尤其是房地产公司）进行比较的时候，如果简单比较市盈率、市净率，很可能踩进一口巨大的陷阱里。某些看上去市盈率、市净率很低的企业，是因为采用公允价值模式计量其拥有的大量投资性房地产，从而使每年房价的涨幅，体现在当年的净利润和净资产里，“显”得获利能力很强、净资产很高而已。</li>
</ol>
</li>
</ol>
</li>
</ol>
<table>
<thead>
<tr>
<th align="left">科目</th>
<th align="left">重点关注</th>
</tr>
</thead>
<tbody><tr>
<td align="left">交易性金融资产</td>
<td align="left">公允价值变动记入利润表</td>
</tr>
<tr>
<td align="left">持有至到期投资</td>
<td align="left">实际利率与摊余成本决定实际投资收益</td>
</tr>
<tr>
<td align="left">可供出售金融资产</td>
<td align="left">公允价值变动加入净资本</td>
</tr>
<tr>
<td align="left">长期股权投资</td>
<td align="left">分红影响利润（成本法），或经营盈亏影响利润（权益法）</td>
</tr>
<tr>
<td align="left">买入返售金融资产</td>
<td align="left">一种用以规避监管的抵押贷款</td>
</tr>
<tr>
<td align="left">投资性房地产</td>
<td align="left">公允价值模式对利润和净资产影响巨大</td>
</tr>
</tbody></table>
<h2 id="负债"><a href="#负债" class="headerlink" title="负债"></a>负债</h2><ol>
<li>负债</li>
<li>所有者权益</li>
</ol>
<table>
<thead>
<tr>
<th align="left">科目</th>
<th align="left">重点关注</th>
</tr>
</thead>
<tbody><tr>
<td align="left">负债</td>
<td align="left">关注有息负债与现金及等价物及总资产的比例</td>
</tr>
<tr>
<td align="left">股本和资本公积</td>
<td align="left">面值算股本，股东投入超过面值的部分算资本公积</td>
</tr>
<tr>
<td align="left">盈余公积</td>
<td align="left">法定及自愿留下来用于扩产的钱</td>
</tr>
<tr>
<td align="left">未分配利润</td>
<td align="left">资金支配自由度高。有利润不等于有现金可分</td>
</tr>
</tbody></table>
<h2 id="阅读资产负债表注意点"><a href="#阅读资产负债表注意点" class="headerlink" title="阅读资产负债表注意点"></a>阅读资产负债表注意点</h2><ol>
<li>负债和所有者权益优先看<ol>
<li>有价值的负债率计算应该使用“有息负债/总资产”。</li>
</ol>
</li>
<li>资产项目<ol>
<li>生产资产÷总资产；<ol>
<li>轻资产公司优于重资产公司</li>
<li>”当年税前利润总额/生产资产”，得出的比值如果显著高于社会平均资本回报率（按银行贷款标准利率的两倍毛估），则属于轻公司，反之则属于重公司</li>
</ol>
</li>
<li>应收÷总资产；<ol>
<li>应收=“应收”两个字的科目数字总和，减去“应收票据”里银行承兑汇票金额</li>
<li>看是否过大</li>
<li>是否有巨变</li>
<li>是否有异常</li>
</ol>
</li>
<li>货币资金÷有息负债；<ol>
<li>衡量公司是否有债务危机</li>
</ol>
</li>
<li>非主业资产÷总资产<ol>
<li>一个公司是否将注意力放在自己擅长的领域</li>
</ol>
</li>
</ol>
</li>
</ol>
<table>
<thead>
<tr>
<th align="left">科目</th>
<th align="left">重点关注</th>
</tr>
</thead>
<tbody><tr>
<td align="left">负债和权益</td>
<td align="left">看有息负债的占比、期限、利率</td>
</tr>
<tr>
<td align="left">资产</td>
<td align="left">生产资产÷总资产；应收÷总资产；货币资金÷有息负债；非主业资产÷总资产</td>
</tr>
</tbody></table>
<h1 id="利润表"><a href="#利润表" class="headerlink" title="利润表"></a>利润表</h1><blockquote>
<p>市场之所以如此重视利润表，是因为股价由市盈率和每股收益的乘积决定，即<br>P（股价）=PE（市盈率）×E（每股收益）<br>因为PE=股价÷每股收益，所以这个公式是个永不会错的套套逻辑（Tautology：同义反复）。但它提供了一个看问题的角度，引导意图获取股票价差的投资人永远关心两个数字：市盈率和每股收益。<br>对这两个数字的不同侧重，产生两种不同的投资体系：一种体系追逐市场参与者心理变化，捕捉市盈率从低到高或从高到更高的股价变动；另一种体系分享企业成长，寻找每股收益从低到高或从高到更高的收益。当然，也有集大成者，追求市盈率和每股收益双增长的“戴维斯双击”。</p>
</blockquote>
<h2 id="利润表重点"><a href="#利润表重点" class="headerlink" title="利润表重点"></a>利润表重点</h2><ol>
<li>从营业收入到营业利润的过程；</li>
<li>从营业利润到净利润的变化。</li>
</ol>
<h2 id="创造利润的过程"><a href="#创造利润的过程" class="headerlink" title="创造利润的过程"></a>创造利润的过程</h2><ol>
<li>营业总收入<ol>
<li>营业收入 + 利息收入 + 已赚保费 + 手续费及佣金收入</li>
<li>注意营业收入的确认原则</li>
</ol>
</li>
<li>毛利率<ol>
<li>营业收入-营业成本</li>
<li>企业最终利润的高低由三个因素决定，即毛利率高低、周转率快慢或经营杠杆大小。老唐分别叫它们为“茅台模式”“沃尔玛模式”和“银行模式”，这三种情况分别代表产品竞争力强弱、管理层运营能力的高低、企业承担的风险大小。</li>
</ol>
</li>
<li>营业总成本<ol>
<li>营业成本</li>
<li>营业税金及附加<ul>
<li>营业过程中无论是否盈利都需要缴纳的税费，包括营业税、消费税、城市维护建设税、资源税、教育费附加以及其他的搭车收费。</li>
</ul>
</li>
<li>营业费用<ul>
<li>销售费用</li>
<li>管理费用：企业管理环节有关的费用</li>
<li>财务费用：自有资金利息收入；债务的利息支出；在银行等金融机构办业务支出的手续费。</li>
</ul>
</li>
<li>资产减值损失</li>
</ol>
</li>
<li>营业利润<ol>
<li>营业总收入-营业总成本+（公允价值变动收益、投资收益、汇兑收益）</li>
</ol>
</li>
<li>净利润<ol>
<li>营业利润+营业外收支净额 - 所得税</li>
</ol>
</li>
</ol>
<h2 id="读利润表重点"><a href="#读利润表重点" class="headerlink" title="读利润表重点"></a>读利润表重点</h2><ol>
<li><p>营业收入</p>
<p><strong>注意</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 潜在需求的增长，在行业内不会产生受损者（仅受益程度不同），不会遭遇反击，增长的可靠性最高；</span><br><span class="line">2. 份额的扩大，是以竞争对手受损为代价的，势必遭受竞争对手的反击，因而要评估竞争对手的反击力度及反击下增长的可持续性；</span><br><span class="line">3. 价格的提升，是以客户付出更多为代价，可能迫使客户减少消费或寻找替代品，需要评估的是消费的替代性强弱。</span><br></pre></td></tr></table></figure></li>
<li><p>毛利率</p>
<ol>
<li>A股中毛利率比较高的行业有信息技术、医药生物、食品饮料、餐饮旅游、文化传播、房地产等</li>
<li>高每股收益与低市盈率的组合，完全有可能不如低每股收益与高市盈率的组合</li>
</ol>
</li>
<li><p>费用率</p>
<ol>
<li>三费/营业总收入</li>
<li>如果费用（销售费用、管理费用及正的财务费用之和）能够控制在毛利润的30%以内，就算是优秀的企业了；在30%～70%区域，仍然是具有一定竞争优势的企业；如果费用超过毛利润的70%，通常而言，关注价值不大。</li>
<li>研发费用高的公司估值（可能失败可能成功，风险高）：使用凯利公式来合理管理资金</li>
</ol>
</li>
<li><p>营业利润率</p>
<ol>
<li>营业利润÷营业总收入</li>
</ol>
</li>
<li><p>确认净利润是否变成现金回到公司账户</p>
<ol>
<li>经营现金流净额/净利润</li>
</ol>
</li>
</ol>
<h1 id="现金流量表"><a href="#现金流量表" class="headerlink" title="现金流量表"></a>现金流量表</h1><blockquote>
<p>现金流量表就是负责展示企业现金来龙去脉信息的一张表。<br>最终企业的现金活动通过三大板块展示，即筹资活动现金流、投资活动现金流和经营活动现金流。<br>现金流量表并不是统计公司现金流水的结果，现金流量表是从利润表和资产负债表里推导出来的，是资产负债表和利润表的补充说明。</p>
</blockquote>
<h2 id="现金流量表拆解"><a href="#现金流量表拆解" class="headerlink" title="现金流量表拆解"></a>现金流量表拆解</h2><blockquote>
<p>从净利润数字反推出经营活动现金收入净额，所以要经过以下三步:<br>第1步，凡是从净利润里扣除的费用，但实际本期没有支出现金的科目，一律加回去，如资产减值准备、折旧摊销、资产报废损失。<br>第2步，把净利润里跟经营活动无关的收入一律减去，如投资收益，募集资金在专户的利息收入（表中的财务费用，财报第85页有介绍）。<br>第3步，把经营活动中没有包含在成本里的现金支出减去，如多交了税（递延所得税资产）、增加了存货、增加了应收、支付了应付。</p>
</blockquote>
<ol>
<li>经营活动现金流的关键数字<ol>
<li>经营活动现金流量净额<ol>
<li>经营活动现金流净额÷净利润持续大于等于1的公司，是“印钞机”的概率比较大</li>
</ol>
</li>
<li>销售商品、提供劳务收到的现金<ol>
<li>一般是营业收入的1.17倍，比值大于1就说明企业销售的绝大部分款项都已经收到了</li>
</ol>
</li>
</ol>
</li>
<li>投资活动现金流及筹资活动现金流<ol>
<li>投资活动现金净流量为负数，表明企业处于花钱扩张的阶段。反之，如果投资活动现金净流量为正数，一般表明企业正在收缩，或者至少是扩张速度放缓了。所以，通过投资活动现金流量的正负可以判断企业目前发展的趋势，即收缩还是扩张。</li>
<li>筹资活动：<ol>
<li>权益性筹资：反映市场对企业价值及成长性的估计，可以作为自己对企业估值的参考。</li>
<li>债务性筹资：反映市场对企业信用的评价，可以帮助投资人评价该企业的安全性。</li>
</ol>
</li>
</ol>
</li>
</ol>
<blockquote>
<p>所谓自由现金流，指企业经营活动赚来的钱里，去掉那些为了维持企业盈利能力而必须再投下去的钱。它是股东在不伤及企业获利能力的前提下，可以从企业拿走的回报，是企业*<em>唯一真实的价值</em>。只要是涉及企业价值的评估，几乎都会用到这个概念。简单起见，投资人一般会直接用经营活动现金流净额减去投资活动现金流出净额来作为自由现金流数值。但如果企业的投资活动现金流主要用于扩大规模而非维持现有规模，这样的计算方法，存在对自由现金流的低估。</p>
</blockquote>
<h2 id="企业的现金流肖像"><a href="#企业的现金流肖像" class="headerlink" title="企业的现金流肖像"></a>企业的现金流肖像</h2><p>+代表流入，-代表流出</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">经营活动现金流净额</th>
<th align="left">投资活动现金流净额</th>
<th align="left">筹资活动现金流净额</th>
<th align="left">企业类型</th>
<th align="left">关注要点</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">+</td>
<td align="left">+</td>
<td align="left">+</td>
<td align="left">妖精型：筹资活动，可能是投资，也可能是套钱，看是否有投资来区分</td>
<td align="left">计划投资项目情况</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">+</td>
<td align="left">+</td>
<td align="left">-</td>
<td align="left">老母鸡型：如果投资现金不是变卖家当所得，且经营现金流入和投资现金流入足以覆盖筹资现金流出，近似一只稳定产生现金的债券</td>
<td align="left">低PE，高股息率</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">+</td>
<td align="left">-</td>
<td align="left">+</td>
<td align="left">蛮牛型：扩张，但是投资项目是否成功需要考虑</td>
<td align="left">项目前景，资金支持</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">+</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">奶牛型：经营现金流入要大于投资现金流出和筹资现金流出的总和</td>
<td align="left">可持续性</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">-</td>
<td align="left">+</td>
<td align="left">+</td>
<td align="left">骗吃骗喝型：跟类型6一样，略好于6</td>
<td align="left">不建议投资</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">-</td>
<td align="left">+</td>
<td align="left">-</td>
<td align="left">整容老母鸡型：看投资现金流是否足以支撑两个出血点的现金流失，否就是混吃等死型的</td>
<td align="left">不建议投资</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">+</td>
<td align="left">赌徒型：看投资项目的前景，还看这个赌徒的个人品性和赌运</td>
<td align="left">项目前景和管理层品性</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">大出血型：马上要退市</td>
<td align="left">拒绝参与</td>
</tr>
</tbody></table>
<h2 id="读现金流量表重点"><a href="#读现金流量表重点" class="headerlink" title="读现金流量表重点"></a>读现金流量表重点</h2><ol>
<li>陷阱<ol>
<li>一是控股股东或管理层期间挪用上市公司现金，报表节点归还；</li>
<li>二是借用一次性行为美化当期现金流；</li>
<li>三是抓住投资者更关注经营活动现金流量净额的特性，将投资活动和筹资活动产生的现金流入化妆成经营活动现金流入，或者将经营活动现金流出化妆成投资和筹资活动现金流出。</li>
</ol>
</li>
<li>异常<ol>
<li>经营现金活动现金流量中的异常现象主要有：<ol>
<li>持续的经营活动现金流净额为负。</li>
<li>虽然经营活动现金流量表净额为正，但主要是因为应付账款和应付票据的增加。应付账款和应付票据的大量增加，可能意味着企业拖欠供应商货款，是企业资金链断裂前的一种异常征兆。</li>
<li>经营活动现金流净额远低于净利润，这一迹象在提示投资者需要注意企业利润造假的可能。</li>
</ol>
</li>
<li>投资现金活动现金流量中的异常现象<ol>
<li>购买固定资产、无形资产等的支出，持续高于经营活动现金流量净额，说明企业持续借钱维持投资行为。出现这种情况，要么是某项目给了管理层无敌的信心，要么就是某种特殊原因造成企业必须流出现金。若投资者找不到无敌信心的来源，可能就要选择后者的假设，这通常是营业收入造假和利润造假的资金源头。</li>
<li>投资活动现金流入里面，有大量现金是因出售固定资产或其他长期资产而获得的。这可能是企业经营能力衰败的标志，是企业经营业绩进入下滑跑道的信号灯。</li>
</ol>
</li>
<li>筹资现金活动现金流量中的异常现象<ol>
<li>企业取得借款收到的现金，远小于归还借款支付的现金。这可能透露银行降低了对该企业的贷款意愿，使用了“骗”回贷款的手段（银行常用手法：“唐老板，请你先找笔钱还了到期贷款，我们要应付上面的检查，上面没意见，我才好安排新贷款给你呀。放心啦，你我好兄弟讲义气，所有的关系和手续都已经搞定了，一周时间给你批下来。”唐老板借了一笔高利贷还了银行贷款，然后银行就遇到一堆“意外情况”，之后就没有下文了）。春江水暖鸭先知，这种“骗贷”行为可能意味着企业出现某种圈内人士才知道的危机。</li>
<li>企业为筹资支付了显然高于正常水平的利息或中间费用——体现在“分配股利、利润或偿付利息支付的现金”和“支付其他与筹资活动有关的现金”两个科目的明细里。当然，这也可能意味着企业遇到必须江湖救急的生存危机。</li>
</ol>
</li>
</ol>
</li>
<li>你如果是想寻找优质企业，关注以下5组数据：<ol>
<li>经营活动产生的现金流量净额＞净利润＞0；</li>
<li>销售商品、提供劳务收到的现金≥营业收入；</li>
<li>投资活动产生的现金流量净额＜0，且主要是投入新项目，而非用于维持原有生产能力；</li>
<li>现金及现金等价物净增加额＞0，可放宽为排除分红因素，该科目＞0；</li>
<li>期末现金及现金等价物余额≥有息负债，可放宽为期末现金及现金等价物+应收票据中的银行承兑汇票＞有息负债。</li>
</ol>
</li>
<li>阅读现金流量表的时候，我们至少应该制作这样三张图进行观察<ol>
<li>净利润，经营现金流净额</li>
<li>销售收现，营业收入</li>
<li>现金余额，投资支出，现金分红，有息负债</li>
</ol>
</li>
</ol>
<h1 id="财报的综合阅读及分析"><a href="#财报的综合阅读及分析" class="headerlink" title="财报的综合阅读及分析"></a>财报的综合阅读及分析</h1><h2 id="财务分析"><a href="#财务分析" class="headerlink" title="财务分析"></a>财务分析</h2><ol>
<li><p>企业财务分析四步走</p>
<ol>
<li><p>浏览资产负债表和利润表各科目，关注有无异常</p>
<ol>
<li>看某科目出现明显过大比例的变动</li>
</ol>
</li>
<li><p>进行财务指标的历史分析</p>
</li>
<li><p>对比企业利润和现金流量变化的趋势</p>
<ol>
<li>企业的净利润总量与经营活动现金流量净额总量，应该保持一个大致稳定的比例，且最好是经营活动现金流净额大于净利润</li>
</ol>
</li>
<li><p>将企业与竞争对手比较</p>
<ol>
<li><p>一方面是比较资产负债结构，看行业内人士对资源的运用方向是否观点一致，对未来发展是有共识还是分歧；</p>
</li>
<li><p>另一方面是比较利润表指标，通过利润产生过程中的各项收入和费用的比较，观察管理层是否称职，是否有效地运用了股东提供的资源。</p>
<h2 id="财务指标分析"><a href="#财务指标分析" class="headerlink" title="财务指标分析"></a>财务指标分析</h2></li>
</ol>
</li>
</ol>
</li>
<li><p>安全性分析</p>
</li>
</ol>
<blockquote>
<p>企业在一年内或一个营业周期内需要偿付的债务, 流动负债。<br>企业能够用以偿还流动债务的资产是流动资产。<br>安全性分析主要是观察流动资产与流动负债之间的关系，常见指标有两种，即流动比率和速动比率。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">流动比率&#x3D;流动资产÷流动负债</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">速动比率&#x3D;速动资产÷流动负债</span><br></pre></td></tr></table></figure>
<blockquote>
<p>教科书一般认为流动比率在2左右，速动比率在1左右，属于企业比较理想的状态。比率过高，说明流动资产未能有效利用，太低说明企业有短期偿债风险。速动资产的定义是流动资产里去除存货后的剩余部分。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">速动比率&#x3D;（流动资产-存货）÷流动负债</span><br></pre></td></tr></table></figure>

<p>安全性指标只需一个就够了（自己用的，没名字），即</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">现金及现金等价物÷有息负债≥1</span><br></pre></td></tr></table></figure>

<p>或适度放宽为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">（货币资金+金融资产净值）÷有息负债≥1</span><br></pre></td></tr></table></figure>
</blockquote>
<ol>
<li>盈利能力分析</li>
</ol>
<blockquote>
<p>从收入角度看盈利能力，投资者要关注营业利润率、毛利率和净利率。其中尤以营业利润率最为重要。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">营业利润率&#x3D;（营业收入-营业成本-三费）÷营业收入</span><br><span class="line"></span><br><span class="line">毛利率&#x3D;（营业收入-营业成本）÷营业收入</span><br><span class="line"></span><br><span class="line"> 净利率&#x3D;净利润÷营业收入</span><br></pre></td></tr></table></figure>

<p>毛利率显示企业产品的竞争力；营业利润率和净利率，则附加了费用信息。</p>
<p>从资产角度看，投资者要关注净资产收益率和总资产收益率。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">净资产收益率&#x3D;净利润÷平均净资产</span><br><span class="line"></span><br><span class="line">总资产收益率&#x3D;净利润÷平均总资产</span><br></pre></td></tr></table></figure>

<p>平均净资产或平均总资产，可以简单地用期末值与期初值之和除以2得出。<br>平均总资产，考虑了杠杆因素，净资产收益率相等，总资产收益率越高，说明盈利水平越高</p>
</blockquote>
<ol>
<li>成长性分析</li>
</ol>
<blockquote>
<p>从收入角度看，重点看营业收入增长率和营业利润增长率；从资产角度看，重点看总资产增长率和净资产增长率。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">营业收入增长率&#x3D;（本期营业收入-上期营业收入）÷上期营业收入</span><br><span class="line"></span><br><span class="line">营业利润增长率&#x3D;（本期营业利润-上期营业利润）÷上期营业利润</span><br><span class="line"></span><br><span class="line">总资产增长率&#x3D;（本期总资产-上期总资产）÷上期总资产</span><br><span class="line"></span><br><span class="line">净资产增长率&#x3D;（本期净资产-上期净资产）÷上期净资产 </span><br></pre></td></tr></table></figure>
</blockquote>
<ol>
<li>管理能力分析</li>
</ol>
<blockquote>
<p>管理层能力的主要观察指标包括应收账款周转率、存货周转率、固定资产周转率、总资产周转率等</p>
<ol>
<li><p>周转率高说明应收账款在一个年度里转化为现金的次数越多，每次拖欠的应收账款回收速度更快</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">应收账款周转率&#x3D;营业收入÷平均应收账款</span><br><span class="line"></span><br><span class="line">平均应收账款&#x3D;（期初应收账款总额+期末应收账款总额）&#x2F; 2</span><br></pre></td></tr></table></figure>
</li>
<li><p>存货周转率越高，存货占用的资金越少。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> 存货周转率&#x3D;营业成本÷存货平均余额</span><br><span class="line"></span><br><span class="line">存货平均余额&#x3D;（期初存货总额+期末存货总额）&#x2F; 2</span><br></pre></td></tr></table></figure>
</li>
<li><p>反映企业属于“轻资产企业”还是“重资产企业”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">固定资产周转率&#x3D;营业收入÷固定资产净值</span><br></pre></td></tr></table></figure>
</li>
<li><p>综合评价企业全部资产经营质量和利用效率的重要指标。总资产周转率越大，证明同样数量的资产，产生更多的销售收入；或者同样的销售收入，占用更少的企业资源。总资产周转率越大，反映企业管理层资产运用能力越强。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">总资产周转率&#x3D;营业收入÷平均总资产</span><br></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<ol>
<li>总体分析<ol>
<li>杜邦分析法<ol>
<li>净资产收益率=净利润/销售收入 X 销售收入/平均总资产 X 平均总资产/净资产</li>
<li>净资产收益率=产品净利润率（净利润÷销售收入）X 总资产周转率（销售收入÷平均总资产） X 杠杆系数（平均总资产÷净资产）</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="使用财务数据估值"><a href="#使用财务数据估值" class="headerlink" title="使用财务数据估值"></a>使用财务数据估值</h2><ol>
<li>现金流折现法评估企业价值<ol>
<li>决定未来各期，通常是5年或10年的自由现金流</li>
<li>决定贴现率</li>
<li>用初始自由现金流x（1+贴现率）^年 算出每年的自由现金流</li>
<li>算永续价值：永久价值=[第5年或第10年的现金流x(1+预期增长率)] / (贴现率-预期增长率)</li>
<li>算当前折现后企业价值：第3，4步总和加总 / (1+贴现率)^(5或10)</li>
<li>内在企业价值=折现后的企业价值，内在价值/股票数，就是每股内在企业价值</li>
</ol>
</li>
<li>清算价值估值法</li>
<li>股市价值法</li>
</ol>
<h1 id="所有者权益变动表和财报附注"><a href="#所有者权益变动表和财报附注" class="headerlink" title="所有者权益变动表和财报附注"></a>所有者权益变动表和财报附注</h1><h2 id="所有者权益变动表"><a href="#所有者权益变动表" class="headerlink" title="所有者权益变动表"></a>所有者权益变动表</h2><p>计入当期利润的利得和损失，包括：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 资产减值损失；</span><br><span class="line">2. 公允价值变动收益；</span><br><span class="line">3. 投资收益；</span><br><span class="line">4. 汇兑收益；</span><br><span class="line">5. 营业外收支。</span><br></pre></td></tr></table></figure>
<p>不计入当期利润的利得和损失，指按照会计准则，计入“资本公积——其他资本公积”科目下的内容，包括：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 可供出售金融资产公允价值变动（不含减值损失和汇兑损益）；</span><br><span class="line">2. 金融资产重分类，重分类日公允价值与账面价值差额；</span><br><span class="line">3. 自用或存货房地产转换为公允价值模式核算的投资性房地产，转换日公允价值与原账面价值的差额；</span><br><span class="line">4. 采用权益法核算的长期股权投资，被投资单位除净利润以外的所有者权益变动，在持股比例不变的情况下，企业按照持股比例计算应享有的份额；</span><br><span class="line">5. 可转换债券所含权益对应的公允价值。</span><br></pre></td></tr></table></figure>
<h2 id="财报附注"><a href="#财报附注" class="headerlink" title="财报附注"></a>财报附注</h2><blockquote>
<p>对于投资者来说，财报附注应该细读，尤其是“合并报表项目解释”和“母公司财务报表主要项目解释”两部分。但财报附注毕竟是报表的补充说明材料，它并不适合独立阅读。最好的阅读方法是阅读三张大表时，不断地查找附注里的对应解释，当几张表阅读完毕后，再按顺序浏览一遍附注。当你对某公司财报熟悉之后，自然会发现关键数据的所在。</p>
</blockquote>
<h1 id="管理层的汇报"><a href="#管理层的汇报" class="headerlink" title="管理层的汇报"></a>管理层的汇报</h1><h2 id="会计数据和财务指标摘要"><a href="#会计数据和财务指标摘要" class="headerlink" title="会计数据和财务指标摘要"></a>会计数据和财务指标摘要</h2><h2 id="董事会报告"><a href="#董事会报告" class="headerlink" title="董事会报告"></a>董事会报告</h2><ol>
<li>董事会关于公司报告期内经营情况的讨论与分析</li>
<li>董事会关于公司未来发展的讨论与分析</li>
</ol>
<blockquote>
<p>杜邦分析体系、波特五力模型、SWOT分析模型，几乎是所有企业分析都会用到的工具，都需要深入学习</p>
</blockquote>
<h2 id="重要事项"><a href="#重要事项" class="headerlink" title="重要事项"></a>重要事项</h2><h1 id="欺诈与反欺诈"><a href="#欺诈与反欺诈" class="headerlink" title="欺诈与反欺诈"></a>欺诈与反欺诈</h1><h2 id="常见的操纵财报手法"><a href="#常见的操纵财报手法" class="headerlink" title="常见的操纵财报手法"></a>常见的操纵财报手法</h2><ol>
<li>操纵收入<ol>
<li>虚构收入<ol>
<li>虚假交易、虚增成交金额、将非营利性交易确认为收入、显失公平的关联交易等。</li>
</ol>
</li>
<li>借助一次性行为夸大收入<ol>
<li>将出售业务部门或资产所得转化为营业收入；</li>
<li>将收购支出转化为营业收入；</li>
<li>将亏损打包进一个公司或部门，然后出售掩盖亏损；进行互换贸易夸大收入</li>
</ol>
</li>
<li>提前确认收入<ol>
<li>确认尚未开始提供产品或服务的收入、在买家没有明确承担付款义务时确认收入以及确认超过完工百分比对应的收入。</li>
</ol>
</li>
</ol>
</li>
<li>操纵费用<ol>
<li>将本期费用推至未来<ol>
<li>延长折旧摊销年限；</li>
<li>漠视已经形成损失的坏账；</li>
<li>不适当地使用费用资本化手段；</li>
<li>不对受损资产或过时存货提取减值准备；</li>
<li>将费用暂时挂在应收账款或预付账款科目；</li>
<li>推迟在建工程转为固定资产，甚至将日常费用计入在建工程；</li>
<li>通过临时资金冲抵，将长时间坏账化妆成刚形成的应收款，从而降低坏账计提比例等</li>
</ol>
</li>
<li>掩盖成本或亏损<ol>
<li>多计收入，少计原材料成本，少计财务费用，少计销、管费用等。</li>
</ol>
</li>
<li>洗大澡：上市公司利用财务技巧，有意将公司经营及资产情况恶化。<ol>
<li>注销资产或存货，以减低未来折旧或增加未来盘盈；</li>
<li>大额计提应收账款或存货减值损失，以便于未来转回；将经常性费用归入一次性费用计提以减少未来费用等。其中又有两种动机：一种是为了“毁尸灭迹”，把以前虚增的利润冲掉；另一种是为了未来报表好看。</li>
</ol>
</li>
</ol>
</li>
<li>操纵现金流<ol>
<li>增加经营活动现金流入<ol>
<li>投资活动现金流出，收购一家公司，获得收购对象的经营性现金流入。</li>
<li>上市公司出售子公司或业务部门，作价的总款项分为首付款和未来的收入分账两部分。</li>
<li>上市公司出售子公司或业务部门时，剥离并保留应收账款。</li>
<li>上市公司套用买入返售金融资产的思路，将以存货抵押借款的行为，转化为先销售给出借方（如银行或财务公司）到期加价回购的行为，创造了本期经营活动现金流入。</li>
</ol>
</li>
<li>减少经营活动现金流出<ol>
<li>将某些经营活动现金支出，归入投资活动或筹资活动现金支出，减少经营性现金流出</li>
<li>以承兑汇票采购，减少当期经营活动现金流出。</li>
</ol>
</li>
<li>一次性行为美化经营活动现金流净额</li>
</ol>
</li>
</ol>
<h2 id="财报被操纵的痕迹"><a href="#财报被操纵的痕迹" class="headerlink" title="财报被操纵的痕迹"></a>财报被操纵的痕迹</h2><blockquote>
<p>资本市场里，欺诈和反欺诈是永恒的话题。老唐请大家牢记“事反必妖”，无论是突然出奇得好，或者突然出奇得坏，都需要我们去探索背后的解释。如果没有可靠的解释，就必须从收入、费用以及现金流等角度，考虑是否存在欺诈的可能。如此，我们才能在市场里长久地避开陷阱。</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/29/Dynamo-Amazon-s-Highly-Available-Key-value-Store/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason Chao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我住8楼">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/01/29/Dynamo-Amazon-s-Highly-Available-Key-value-Store/" class="post-title-link" itemprop="url">Dynamo Amazon's Highly Available Key-value Store</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-01-29 15:00:59 / 修改时间：15:13:15" itemprop="dateCreated datePublished" datetime="2021-01-29T15:00:59+08:00">2021-01-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>Abstract<br>介绍Dynamo，一个分布式的kv存储系统，具有非常高的可用性和可靠性</p>
</blockquote>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><h2 id="主要目标："><a href="#主要目标：" class="headerlink" title="主要目标："></a>主要目标：</h2><ol>
<li>Reliability</li>
<li>Scalability</li>
<li>提供key-value接口（最受欢迎清单，购物车，用户偏好等）</li>
</ol>
<h2 id="实现技术"><a href="#实现技术" class="headerlink" title="实现技术"></a>实现技术</h2><ol>
<li>使用一致性哈希进行数据分区和备份</li>
<li>使用对象版本信息来处理单个数据备份一致性问题</li>
<li>多副本之间的一致性可以通过类似quorum的协议处理（NWR），以及一个去中心化的副本同步协议</li>
<li>使用gossip分布式算法来实现错误发现和成员关系变更协议</li>
</ol>
<h1 id="BackGround"><a href="#BackGround" class="headerlink" title="BackGround"></a>BackGround</h1><ol>
<li>RDBMS太重，不需要那么多复杂查询和管理函数；扩展性差，负载均衡效果差。</li>
</ol>
<h2 id="系统假设和要求"><a href="#系统假设和要求" class="headerlink" title="系统假设和要求"></a>系统假设和要求</h2><ul>
<li>Query Model: 只需要key-value的操作，不需要关系模式（表格），没有跨多个数据（多列）的操作。</li>
<li>ACID：只需要弱一致性，不用提供事务隔离机制。</li>
<li>Efficiency：需要满足严格的SLA</li>
<li>其他的假设：不需要认证，规模只用到几百</li>
</ul>
<h2 id="SLA"><a href="#SLA" class="headerlink" title="SLA"></a>SLA</h2><p>平均，中位数等指标不能很好的反映所有的用户获得很好的服务质量，它们只能反映大部分用户的服务质量，对于长尾延迟不能反映出来。<br>99.9% 延迟则可以反映所有的用户都有一个很好的服务质量。</p>
<h2 id="设计考虑"><a href="#设计考虑" class="headerlink" title="设计考虑"></a>设计考虑</h2><ol>
<li>支持强一致性的系统的可用性不高，为了提高可用性，一般使用弱一致性。弱一致性会导致副本冲突，而解决副本冲突需要两方面的考虑：<ol>
<li>什么时候解决冲突</li>
<li>谁来解决冲突</li>
</ol>
</li>
<li>dynamo采用最终一致性模型。对于冲突解决，它有以下考虑：<ol>
<li>许多模型采用写的时候解决冲突的方式，这样可以让读的逻辑保持比较简单，但是写容易失败。而dynamo相反，为了保证写可用性，让读来解决冲突</li>
<li>dynamo采用用户来解决冲突的方式，而不是后端存储系统自己解决冲突。因为用户知道数据模式，它可以决定最适合的方式解决冲突。而后端存储系统可以采用的策略就比较有限，比如最后更新的是最终的结果这种方式。</li>
</ol>
</li>
<li>增量扩展性：可以无缝扩展集群</li>
<li>对称性：dynamo的所有node都是对等的</li>
<li>去中心化：dynamo不是中心化结构而是端对端结构</li>
<li>异构性：对于不同性能的机器，可以根据性能来分配任务</li>
</ol>
<h1 id="Related-Work"><a href="#Related-Work" class="headerlink" title="Related Work"></a>Related Work</h1><ol>
<li>p2p系统</li>
<li>分布式文件系统和数据库</li>
<li>讨论<ol>
<li>dynamo 的目标是总是可写</li>
<li>dynamo 的机器都是可信的（不存在恶意机器）</li>
<li>dynamo 不需要层次化的名字空间或者关系模式，只用扁平的模式</li>
<li>dynamo 的性能指标是99.9%的延迟</li>
</ol>
</li>
</ol>
<h1 id="System-Architecture"><a href="#System-Architecture" class="headerlink" title="System Architecture"></a>System Architecture</h1><p>对于生产系统中一个存储系统需要考虑以下方面：</p>
<ol>
<li>负载均衡</li>
<li>成员变动</li>
<li>失败发现</li>
<li>失败恢复</li>
<li>副本同步</li>
<li>超负荷处理</li>
<li>状态转移</li>
<li>并发和任务调度</li>
<li>请求包装（序列化和反序列化）</li>
<li>请求路由</li>
<li>系统监控和报警</li>
<li>配置管理</li>
<li>持久化</li>
<li>数据分区</li>
<li>扩展性</li>
</ol>
<h2 id="dynamo接口"><a href="#dynamo接口" class="headerlink" title="dynamo接口"></a>dynamo接口</h2><ol>
<li>get</li>
<li>put</li>
</ol>
<h2 id="数据分区算法"><a href="#数据分区算法" class="headerlink" title="数据分区算法"></a>数据分区算法</h2><p>一致性哈希算法，如图所示：<br><a target="_blank" rel="noopener" href="https://mychaow.github.io/2018/02/03/dynamo-md/"><img src="https://mychaow.github.io/2018/02/03/dynamo-md/" alt="img"></a><br>基本的一致性哈希算法有以下问题：</p>
<ol>
<li>数据和负载分布不均衡</li>
<li>对于不同机器体现不出异构性</li>
</ol>
<p>采用virtual nodes来解决这个问题，具体的就是每个节点映射多个虚拟节点，虚拟节点组成一个哈希环，有以下好处：</p>
<ol>
<li>一个节点失败了，它的负载会被剩下的所有节点平分</li>
<li>当一个节点加入时，以前的所有节点会将一小部分负载分给它，非常快</li>
<li>虚拟节点数可以反映一个机器的性能，当机器性能高时，可以多映射一点虚拟节点，这样就可以处理更多的负载</li>
</ol>
<h2 id="数据副本"><a href="#数据副本" class="headerlink" title="数据副本"></a>数据副本</h2><ol>
<li>使用N备份，就是一个key落在哈希环上映射的第一个节点，顺时针的往下找N-1个节点作为备份节点。这N个节点称为preference list。</li>
<li>这N个节点要保证是物理节点，防止都是同一个节点的虚拟节点，没有达到备份的效果</li>
</ol>
<h2 id="数据版本"><a href="#数据版本" class="headerlink" title="数据版本"></a>数据版本</h2><p>使用向量时钟来作为数据版本号，最终表示为一系列（node，counter）。</p>
<ol>
<li>当一个版本的对象的所有（node，counter）对都小于或等于另外一个版本的对象，则该对象是另外对象的祖先</li>
<li>dynamo中当一个用户想要更新一个对象时，需要提供上一次读的操作的版本号，用来指定是对某个版本的对象实现更新操作</li>
</ol>
<p>向量时钟表示版本，有一点需要考虑的是：当多个节点并发更新后，（node, counter）对就会变得很多，合并起来占用空间，因此可以设置一个阈值，超过该阈值，从最旧的开始截断。现实中其实很少发现这种需要截断的情况。</p>
<h2 id="get和put操作的执行"><a href="#get和put操作的执行" class="headerlink" title="get和put操作的执行"></a>get和put操作的执行</h2><ol>
<li>用户感知存储节点<ol>
<li>通过一个通用的负载均衡节点来路由选，好处是用户与存储节点解耦</li>
<li>使用自带分区感知能力的client lib库来访问，好处是用户的延迟更低</li>
</ol>
</li>
<li>数据副本一致性<ol>
<li>R + W &gt; N</li>
<li>前N个node作为preference node，选择其中一个作为coordinator来处理读写请求。</li>
</ol>
</li>
</ol>
<h2 id="处理失败"><a href="#处理失败" class="headerlink" title="处理失败"></a>处理失败</h2><p>考虑到严格的R+W&gt;N在网络分区，或临时坏的情况下还是影响可用性，因此可以除了N个preference节点外，对于每个机器设置备份节点<br>Hinted replica，当某个节点不可用时，就把数据发送给它的hinted replica。<br>Dynamo的节点是跨地域的，所以可以提供跨地域可用性。</p>
<h2 id="处理持久化失败"><a href="#处理持久化失败" class="headerlink" title="处理持久化失败"></a>处理持久化失败</h2><p>当Hinted replica的节点也不可用时，数据的持久化就会有危险。为了达到数据写入的安全性，需要副本之间同步新的数据并互为备份。为了发现<br>不同的副本之间的不一致性。使用Merkle trees算法。这个算法就是将不同的key区间进行哈希，父节点是子节点的哈希值的哈希，这样每个<br>节点构造自己的Merkle trees，然后相互比较就能很快的知道哪里不一致了。</p>
<h2 id="成员管理和失败发现"><a href="#成员管理和失败发现" class="headerlink" title="成员管理和失败发现"></a>成员管理和失败发现</h2><ol>
<li>哈希环成员</li>
</ol>
<p>使用基于Gossip算法的协议来传播成员变更信息。</p>
<ol>
<li>外部发现</li>
</ol>
<p>为了防止逻辑分区，设置一些seed节点，让所有的节点与它们通信来获得最终的集群成员信息。</p>
<ol>
<li>错误发现</li>
</ol>
<p>每个节点使用基于Gossip算法来感知其他节点可不可达的信息。</p>
<h2 id="添加和移除节点"><a href="#添加和移除节点" class="headerlink" title="添加和移除节点"></a>添加和移除节点</h2><p>每个节点加入哈希环时，相关节点向它发送key value。当移除时，该节点向映射的其他节点发送key value对。</p>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><ol>
<li>请求协调者</li>
<li>成员管理和失败发现</li>
<li>本地持久化引擎</li>
</ol>
<h2 id="本地持久化引擎"><a href="#本地持久化引擎" class="headerlink" title="本地持久化引擎"></a>本地持久化引擎</h2><p>支持多种引擎，比如mysql，Berkeley DB</p>
<h2 id="请求协调者"><a href="#请求协调者" class="headerlink" title="请求协调者"></a>请求协调者</h2><ol>
<li>使用事件驱动的方式编写，即状态机。每个状态机处理一个用户请求。根据不同的阶段做对应的处理。</li>
<li>put的时候，preference list top N个节点任意一个都可以处理。为了获得更好的一致性，一般写会挑上一次读的时候最快返回结果的节点，这样下次读还是有很大概率读到最新的值。</li>
</ol>
<h1 id="经验教训"><a href="#经验教训" class="headerlink" title="经验教训"></a>经验教训</h1><p>冲突解决方案：</p>
<ol>
<li>业务制定更新冲突解决方法</li>
<li>基于时间序的冲突解决方法</li>
<li>W=N, R=1解决高性能读要求</li>
</ol>
<h2 id="负载均衡性能和持久化性能"><a href="#负载均衡性能和持久化性能" class="headerlink" title="负载均衡性能和持久化性能"></a>负载均衡性能和持久化性能</h2><ol>
<li>使用缓存写来提供系统的写性能</li>
<li>写入的时候指定其中一个副本直接写入到磁盘中，其他的缓存写，这样提高系统数据安全性(持久化)</li>
</ol>
<h2 id="保证系统负载一致性分布"><a href="#保证系统负载一致性分布" class="headerlink" title="保证系统负载一致性分布"></a>保证系统负载一致性分布</h2><p>数据分区和节点映射策略</p>
<ol>
<li><p>每个节点T个随机token，数据分区也是按照token来划分</p>
<p>缺点：</p>
<ol>
<li>新节点加入时，在线节点需要扫描自己的数据集来找到需要传输给新加入节点的数据，影响线上服务。<br>当不想影响线上服务时，降低扫描优先级，会导致新加入节点启动比较慢</li>
<li>节点加入或离开时，许多节点的数据分区和Merkle tree需要重新计算，影响服务</li>
<li>因为数据分区是不固定的，所以没法做snapshot来加快传输数据<br>这个策略不好的根本原因是数据分区和数据放置策略耦合太多</li>
</ol>
</li>
<li><p>每个节点T个随机token，数据是大小固定的划分的</p>
<ol>
<li>哈希空间划分为固定Q个分区，每个节点还是随机分配T个token，其中Q&gt;&gt;N &amp; Q &gt;&gt; S*T S是节点数，N是副本数</li>
<li>每个数据分区以末尾为key顺时针找到下一个token对应的Node<br>优点：</li>
<li>数据放置和数据分区解耦</li>
<li>可以在运行过程中改变数据放置</li>
</ol>
</li>
<li><p>每个节点Q/S个token,数据是大小固定的划分的</p>
<ol>
<li>跟2策略一样，但是T=Q/S，当某个节点离开时，它的token被随机分给其他的节点，<br>当节点加入时，它从别的节点随机拉取token<br>优点：</li>
<li>快速启动和恢复</li>
<li>打包数据（快照）<br>缺点：</li>
<li>改变node 成员关系需要许多节点协作来维持策略3的要求</li>
</ol>
</li>
</ol>
<h2 id="多版本"><a href="#多版本" class="headerlink" title="多版本"></a>多版本</h2><p>原因：</p>
<ol>
<li><p>系统出现节点失败和网络分区时</p>
</li>
<li><p>系统处理大量的并发写<br>数量：</p>
</li>
<li><p>数量非常少</p>
<h2 id="客户端驱动或者服务端驱动定位"><a href="#客户端驱动或者服务端驱动定位" class="headerlink" title="客户端驱动或者服务端驱动定位"></a>客户端驱动或者服务端驱动定位</h2></li>
<li><p>服务端驱动</p>
<ol>
<li>coordinator来执行读和写的协调操作</li>
<li>需要负载均衡器来做请求转发和均衡</li>
</ol>
</li>
<li><p>客户端驱动</p>
<ol>
<li>client定期随机向集群某个节点拉取整个集群的在线node 视图</li>
<li>将读写请求发往指定的coordinator</li>
<li>因为数据分区几乎公平的将数据分散到各个节点，所以不用做负载均衡操作</li>
</ol>
</li>
</ol>
<h2 id="前台和后台任务均衡"><a href="#前台和后台任务均衡" class="headerlink" title="前台和后台任务均衡"></a>前台和后台任务均衡</h2><p>后台任务都是低优先级的任务，为了不影响前台任务，需要控制其资源使用量。<br>dynamo使用一个反馈机制来做这种资源使用控制。</p>
<h2 id="讨论"><a href="#讨论" class="headerlink" title="讨论"></a>讨论</h2><p>dynamo使用gossip来做全局在线node视图传播，只能达到几百台的规模。更大的规模需要做层次化扩展。</p>
<p><em>总结</em></p>
<p>dynamo这篇论文写的非常详细，比较重要的几点：</p>
<ol>
<li>采用99.9% 来衡量SLA</li>
<li>采用一致性哈希模型的数据分区策略</li>
<li>采用向量时钟来作为数据版本信息，并由业务逻辑来处理版本冲突</li>
<li>采用基于gossip算法来处理集群视图的传播</li>
<li>采用NWR算法来保证数据安全性</li>
<li>采用Merkle trees来加快发现版本之间不一致性，从而快速备份数据</li>
</ol>
<table>
<thead>
<tr>
<th align="left">Problem</th>
<th align="left">Technique</th>
<th align="left">Advantage</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Partitioning</td>
<td align="left">Consistent Hashing</td>
<td align="left">Incremental Scalability</td>
</tr>
<tr>
<td align="left">High Availablility for Writes</td>
<td align="left">Vector clocks with reconsiliation during reads</td>
<td align="left">version size decoupled from update rates</td>
</tr>
<tr>
<td align="left">Handing temporary failures</td>
<td align="left">Sloppy Quorum and hinted handoff</td>
<td align="left">Provides high Availablility and durability guarantee when some fo the replicas are not available</td>
</tr>
<tr>
<td align="left">Recovering from permanent failures</td>
<td align="left">Anti-entropy using Merkle trees</td>
<td align="left">Synchronizes divergent replicas in the BackGround</td>
</tr>
<tr>
<td align="left">membership and failure detection</td>
<td align="left">gossip-based membership protocol and failures detection</td>
<td align="left">preserves symmetry and avoids having a centralized registry for Storing membership and node liveness information</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason Chao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
